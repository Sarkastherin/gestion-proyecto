import{r as d,j as e,w as y}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{B as v}from"./Buttons-DjYWmDVV.js";import{C as j}from"./Cards-BPIQ6iiA.js";import{u as w}from"./ContactsContext-BtjVusI7.js";import{u as z}from"./useModalState-Dynfoma4.js";import{D as _}from"./DailyReportModal-BTKlqsh-.js";import{B as P}from"./Buttons-ByA9cNaT.js";import{n as C}from"./functionsDays-BZooa-Ef.js";import{G as M,F as S,a as D}from"./index-DkrmnPDN.js";import{u as E}from"./DataContext-BHROWMOn.js";import{a as F}from"./Containers-ZXGJ7diH.js";import"./IconComponent-CkWBZZXK.js";import"./ModalBase-Czr0Q5I6.js";import"./index.esm-CLpX3RIH.js";import"./Inputs-cvlDeTHR.js";import"./UIContext-9PjeG9pu.js";import"./supabaseClient-O5NoNd5h.js";import"./updatesArraysFields-CDmdxi8j.js";import"./realTime-Csd-v9-x.js";import"./index-DG_GJQZz.js";import"./Badge-BNjmnaCE.js";import"./EntityTable-DKwDIY9O.js";import"./updatesSingleRow-C5gkTyzt.js";import"./ClipboardDocumentCheckIcon-C0qHNpyc.js";import"./UserGroupIcon-DFLFYX-R.js";import"./Link-DZjWQWvu.js";import"./functions-CIXTKjf3.js";import"./TrashIcon-CpHN25SK.js";import"./arrow-left-3CO6tBoR.js";function k(s){const a=s.reduce((r,i)=>(r[i.id_phase]||(r[i.id_phase]=[]),r[i.id_phase].push(i),r),{});return Object.entries(a).map(([r,i])=>{const u=i.reduce((n,c)=>n+c.progress,0)/i.length;return{id_phase:Number(r),progress:Math.round(u)}})}function B(s){if(s.length===0)return 0;const r=s.reduce((i,x)=>i+x.progress,0)/s.length;return Math.round(r)}function G(s){return M({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M1 12C1 5.925 5.925 1 12 1s11 4.925 11 11-4.925 11-11 11S1 18.075 1 12Zm8.036-4.024a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042L10.939 12l-2.963 2.963a.749.749 0 0 0 .326 1.275.749.749 0 0 0 .734-.215L12 13.06l2.963 2.964a.75.75 0 0 0 1.061-1.06L13.061 12l2.963-2.964a.749.749 0 0 0-.326-1.275.749.749 0 0 0-.734.215L12 10.939Z"},child:[]}]})(s)}function A({phases_project:s,supervisorsById:a,getProgress:r}){const[i,x]=d.useState(null),u=n=>{x(c=>c===n?null:n)};return e.jsxs("div",{className:"rounded-xl shadow-md p-6 border border-zinc-200 bg-white dark:border-zinc-700 dark:bg-zinc-900/70",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Avance de etapas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"border-b text-zinc-500 dark:text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2",children:"Etapa"}),e.jsx("th",{className:"py-2",children:"Supervisor"}),e.jsx("th",{className:"py-2",children:"Avance"})]})}),e.jsx("tbody",{children:s.map(n=>{const c=i===n.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-b last:border-0 text-zinc-700 dark:text-zinc-200 cursor-pointer hover:bg-zinc-100/50 dark:hover:bg-zinc-800/30",onClick:()=>u(n.id),children:[e.jsxs("td",{className:"py-2 flex items-center gap-2 font-medium",children:[e.jsx(S,{className:`h-4 w-4 transition-transform ${c?"rotate-90 text-primary-text":"text-zinc-400"}`}),n.name]}),e.jsx("td",{className:"py-2",children:a(n.id)}),e.jsxs("td",{className:"py-2",children:[r.get(n.id)??0,"%"]})]},n.id),c&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"p-3 bg-zinc-50 dark:bg-zinc-800/40",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"border-b text-zinc-500 dark:text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1",children:"Tarea"}),e.jsx("th",{className:"py-1",children:"Duración"}),e.jsx("th",{className:"py-1",children:"Personal"}),e.jsx("th",{className:"py-1",children:"Avance"}),e.jsx("th",{className:"py-1",children:"Planificada"})]})}),e.jsx("tbody",{children:n.tasks.map(l=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-1",children:l.name}),e.jsxs("td",{className:"py-1",children:[l.duration," d"]}),e.jsxs("td",{className:"py-1",children:[l.peopleCount??0," /"," ",l.task_assignments.length]}),e.jsxs("td",{className:"py-1",children:[l.progress??0,"%"]}),e.jsx("td",{className:"py-1",children:l.planned?e.jsx(D,{className:"inline text-green-500"}):e.jsx(G,{className:"inline text-red-500"})})]},l.id))})]})})})})]})})})]})})]})}function I({project:s}){var f;const a=z(),[r,i]=d.useState(null),[x,u]=d.useState(null),[n,c]=d.useState(null),{employees:l}=w(),{phases_project:o}=s;if(!o)return;o.flatMap(t=>t.daily_reports);const g=d.useMemo(()=>new Map(l==null?void 0:l.map(t=>[t.id,t.contacto_nombre])),[l]);d.useMemo(()=>new Map(o.map(t=>[t.id,t])),[o]);const N=t=>{const m=o.find(p=>p.id===t);return m!=null&&m.id_supervisor?g.get(m.id_supervisor)??"No asignado":"No asignado"};d.useEffect(()=>{if(!o)return;const t=o.flatMap(h=>h.tasks),m=k(t),p=B(t);u(p),i(m)},[o]);const b=d.useMemo(()=>new Map(r==null?void 0:r.map(t=>[t.id_phase,t.progress])),[r]);return d.useEffect(()=>{if(s.plan_duration&&s.plan_duration>0){const t=s.plan_start_date,m=new Date().toLocaleDateString("sv-SE"),p=s.mode;if(!t||!p)return;const h=C(t,m,p);c(h)}},[s]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:["Cliente: ",s.client.nombre]}),e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:["Inicio: ",s.start_date," ",s.end_date&&`• Fin: ${s.end_date}`]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex gap-2",children:[e.jsx(v,{variant:"primary",onClick:()=>a.openModal({type:"new"}),children:"Crear Parte Diario"}),e.jsx(P,{variant:"light",route:`/projects/${s.id}/planning`,children:"Ver Planificación"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(j,{title:"Avance Global",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[x??0,"%"]}),e.jsx("div",{className:"mt-2 w-full bg-zinc-200 dark:bg-zinc-700 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-text h-2 rounded-full",style:{width:`${x??0}%`}})})]}),e.jsxs(j,{title:"Días consumidos",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[n," d"," ",e.jsxs("span",{className:"text-sm text-zinc-500",children:["/ ",s.plan_duration," d"]})]}),e.jsx("div",{className:"mt-2 w-full bg-zinc-200 dark:bg-zinc-700 rounded-full h-2",children:e.jsx("div",{className:"bg-lime-500 h-2 rounded-full",style:{width:`${s.plan_duration?Math.round((n??0)/s.plan_duration*100):0}%`}})})]})]}),e.jsx(A,{phases_project:o,supervisorsById:N,getProgress:b})]}),((f=a.data)==null?void 0:f.type)&&e.jsx(_,{open:a.open,onClose:a.closeModal,type:a.data.type,report:a.data.data})]})}function pe({}){return[{title:"Resumen"},{name:"description",content:"Resumen del proyecto"}]}const ue=y(function(){const{selectedProject:a}=E();if(!a)return;const{phases_project:r}=a;if(r)return e.jsx(F,{children:e.jsx(I,{project:a})})});export{ue as default,pe as meta};
