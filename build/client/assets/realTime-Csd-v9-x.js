import{s as n}from"./supabaseClient-O5NoNd5h.js";import{r as i}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{a as m}from"./UIContext-9PjeG9pu.js";import{u}from"./DataContext-BHROWMOn.js";function g(r){const{refreshMaterial:s}=u(),e=i.useRef(null),t=500;i.useEffect(()=>{const a=n.channel("realtime:materials_prices");return["materials","prices"].forEach(c=>{a.on("postgres_changes",{event:"*",schema:"public",table:c},l=>{console.log(`[${c.toUpperCase()}] Evento recibido:`,l),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{s(r),e.current=null},t)})}),a.subscribe(),()=>{n.removeChannel(a),e.current&&clearTimeout(e.current)}},[r])}function T(){const{getUnits:r}=u();i.useEffect(()=>{const s=n.channel("realtime:units").on("postgres_changes",{event:"*",schema:"public",table:"units"},()=>{console.log("ejecutando getUnits()"),r()}).subscribe();return()=>{n.removeChannel(s)}},[])}function _(){const r=i.useRef(null),{getCategorizations:s,categorizations:e}=m();i.useEffect(()=>{const t=n.channel("realtime:categorizations_realtime");return["families","categories","subcategories"].forEach(o=>{t.on("postgres_changes",{event:"*",schema:"public",table:o},c=>{console.log(`[${o.toUpperCase()}] Evento recibido:`,c),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{console.log("refrescando categorias"),s(),r.current=null},500)})}),t.subscribe(),()=>{n.removeChannel(t),r.current&&clearTimeout(r.current)}},[e])}function d(){const{selectedOpportunity:r,refreshOpportunity:s}=u(),e=i.useRef(null);i.useEffect(()=>{if(!r)return;const t=n.channel("realtime:opportunity_realtime");return["opportunities","quotes","details_items","details_materials","phases"].forEach(o=>{t.on("postgres_changes",{event:"*",schema:"public",table:o},c=>{console.log(`[${o.toUpperCase()}] Evento recibido:`,c),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{s(),e.current=null},500)})}),t.subscribe(),()=>{n.removeChannel(t),e.current&&clearTimeout(e.current)}},[])}function v(){const{selectedProject:r,refreshProject:s}=u(),e=i.useRef(null);i.useEffect(()=>{if(!r)return;const t=n.channel("realtime:project_realtime");return["projects","phases_project","budget_details_items","budget_details_materials"].forEach(o=>{t.on("postgres_changes",{event:"*",schema:"public",table:o},c=>{console.log(`[${o.toUpperCase()}] Evento recibido:`,c),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{s(),e.current=null},500)})}),t.subscribe(),()=>{n.removeChannel(t),e.current&&clearTimeout(e.current)}},[])}function E(){const{selectedProject:r,refreshProject:s}=u(),e=i.useRef(null);i.useEffect(()=>{if(!r)return;const t=n.channel("realtime:tasks_reports_realtime");return["tasks","task_assignments"].forEach(o=>{t.on("postgres_changes",{event:"*",schema:"public",table:o},c=>{console.log(`[${o.toUpperCase()}] Evento recibido:`,c),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{s(),e.current=null},500)})}),t.subscribe(),()=>{n.removeChannel(t),e.current&&clearTimeout(e.current)}},[])}function R(r){const{selectedProject:s,refreshProject:e}=u(),t=i.useRef(null);i.useEffect(()=>{if(!s)return;const a=n.channel("realtime:daily_reports_realtime");return["daily_reports","report_employees","report_tasks"].forEach(c=>{a.on("postgres_changes",{event:"*",schema:"public",table:c},l=>{console.log(`Page: ${r} [${c.toUpperCase()}] Evento recibido:`,l),t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{e(),t.current=null},500)})}),a.subscribe(),()=>{n.removeChannel(a),t.current&&clearTimeout(t.current)}},[s])}export{v as a,g as b,R as c,T as d,_ as e,E as f,d as u};
