import{w as j,r as x,a as y,j as e}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import"./UIContext-9PjeG9pu.js";import{u as f}from"./DataContext-BHROWMOn.js";import{C as N}from"./Cards-BPIQ6iiA.js";import{a as g}from"./Containers-ZXGJ7diH.js";import{B as b,a as z}from"./Badge-BNjmnaCE.js";import{a as w}from"./Buttons-ByA9cNaT.js";import{F as k}from"./BriefcaseIcon-8tP6iIlB.js";import"./supabaseClient-O5NoNd5h.js";import"./ContactsContext-BtjVusI7.js";import"./functions-CIXTKjf3.js";import"./IconComponent-CkWBZZXK.js";import"./arrow-left-3CO6tBoR.js";import"./Buttons-DjYWmDVV.js";import"./Link-DZjWQWvu.js";import"./TrashIcon-CpHN25SK.js";function H({}){return[{title:"Nueva Oportunidad"},{name:"description",content:"Nueva Oportunidad"}]}const v=(a,r,d)=>{var n;if(!a||!r||!d)return[];const c=new Map,o=a.details_materials.filter(s=>s.id_quote===r);for(const s of o){const l=`${s.id_material}-${s.id_price}`,p=(n=d.find(u=>u.id===s.materials.id_unit))==null?void 0:n.description,m=c.get(l);m?c.set(l,{...m,quantity:m.quantity+s.quantity}):c.set(l,{...s,unit:p})}const i=Array.from(c.values()),t=a.details_items.filter(s=>s.id_quote===r);return[...i,...t]},T=({selectedOpportunity:a,totalQuote:r})=>{if(!a)return null;const{name:d,client:c,created_at:o,phases:i,quotes:t,status:n}=a;return e.jsxs(N,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:d||"Oportunidad sin nombre"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:[a.id_project&&e.jsx(b,{variant:"green",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-5"})," Proyecto creado"]})}),e.jsx(z,{status:n||"default",children:n||"!"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cliente:"})," ",e.jsx("span",{children:c.nombre??"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha de creaci贸n:"})," ",e.jsx("span",{children:new Date(o).toLocaleDateString()})]}),e.jsxs("div",{className:"row-span-2",children:[e.jsx("span",{className:"font-medium block mb-1",children:"Etapas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(i==null?void 0:i.length)>0?i.map(s=>e.jsx("span",{className:"px-3 py-0.5 rounded-full text-xs bg-zinc-200 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 font-medium",children:s.name},s.id)):e.jsx("span",{className:"text-zinc-400",children:"No definidas"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total estimado:"})," ",e.jsx("span",{className:"font-semibold",children:(r==null?void 0:r.toLocaleString("es-AR",{style:"currency",currency:"USD"}))??"0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cotizaciones asociadas:"})," ",e.jsx("span",{children:(t==null?void 0:t.length)??0})]})]})]})},C=({details:a})=>{const[r,d]=x.useState("Todos"),c=x.useMemo(()=>{const t=new Set(a.map(n=>n.type));return["Todos",...Array.from(t)]},[a]),o=x.useMemo(()=>r==="Todos"?a:a.filter(t=>t.type===r),[a,r]);if(!a.length)return e.jsx("p",{className:"text-sm text-zinc-400",children:"No hay detalles para esta cotizaci贸n."});const i=[{label:"TIPO",key:"type"},{label:"ID MATERIAL",key:"materials.id"},{label:"DESCRIPCION MATERIAL",key:"materials.description"},{label:"DESCRIPCION ITEM",key:"item"},{label:"CANTIDAD",key:"quantity"},{label:"PRECIO UNITARIO",key:"prices.price"},{label:"PRECIO UNITARIO",key:"unit_cost"},{label:"UNIDAD",key:"unit"}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2 mt-6 mb-4 sm:items-center",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Detalle de la cotizaci贸n"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:c.map(t=>e.jsx("button",{onClick:()=>d(t),className:`text-sm px-3 py-1 rounded-full border ${r===t?"bg-yellow-200 text-yellow-700 border-yellow-400":"bg-zinc-100 text-zinc-500 border-zinc-300 dark:bg-zinc-700 dark:border-zinc-700 dark:text-zinc-400"}`,children:t},t))}),e.jsx(w,{data:o,headers:i,filename:`detalle_cotizacion_${a[0].id_quote}_${r.toLocaleLowerCase()}`,type:"resumen"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full border border-zinc-300 dark:border-zinc-700 rounded-md text-sm",children:[e.jsx("thead",{className:"bg-white text-zinc-600 dark:bg-zinc-900/70 dark:text-zinc-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Descripci贸n"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Unidad"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Precio Unitario"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:o.map((t,n)=>{var u,h;const s="unit_cost"in t,l=s?t.unit_cost??0:((u=t.prices)==null?void 0:u.price)??0,p=s?t.item??"-":((h=t.materials)==null?void 0:h.description)??"-",m=s?"Unidad":t.unit??"-";return e.jsxs("tr",{className:"border-t border-zinc-300 dark:border-zinc-700",children:[e.jsx("td",{className:"px-4 py-2",children:t.type.toUpperCase()}),e.jsx("td",{className:"px-4 py-2",children:p}),e.jsx("td",{className:"px-4 py-2 text-right",children:t.quantity}),e.jsx("td",{className:"px-4 py-2 text-right",children:m}),e.jsx("td",{className:"px-4 py-2 text-right",children:l.toLocaleString("es-AR",{style:"currency",currency:"USD"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:(t.quantity*l).toLocaleString("es-AR",{style:"currency",currency:"USD"})})]},`${t.type}-${n}`)})})]})})]})},Q=j(function(){const[r,d]=x.useState(0),[c,o]=x.useState(null),{selectedQuoteId:i}=y(),{units:t,getUnits:n}=f(),{selectedOpportunity:s}=f(),{quotes:l}=s||{};return x.useEffect(()=>{t||n()},[]),x.useEffect(()=>{const p=l==null?void 0:l.find(m=>m.id===i);p&&(d(p.t_mg_total),t&&o(v(s,i,t)))},[i,t]),e.jsxs(g,{children:[e.jsx(T,{selectedOpportunity:s,totalQuote:r}),t&&e.jsx(C,{details:c??[]})]})});export{Q as default,H as meta};
