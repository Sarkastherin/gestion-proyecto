import{r as o,u as B,j as r}from"./chunk-PVWAREVJ-xN2wnjH-.js";import{m as E}from"./cruds-C8awoSIz.js";import{u as w}from"./index.esm-BDlKQGcf.js";import{u as $}from"./UIContext-CTPOFttf.js";import{a as k}from"./Cards-BrE1Rw6C.js";import{S as g,I as b}from"./Inputs-nFJy7MmX.js";import{F as H}from"./FooterForms-D8IvpDVX.js";import{a as J}from"./realTime-CHJ-WwWR.js";import{S as K}from"./SelectUnits-CSP1Zv-A.js";import{u as Q}from"./DataContext-BJsy23hk.js";import{u as W}from"./updatesSingleRow-BjGTgUib.js";import{u as X}from"./ModalsContext-CDMOE33t.js";const ue=({defaultValues:F,isNew:l,categorization:s,initialEditMode:A})=>{var S,j,y,v,_,C;const[m,M]=o.useState(A),{setSelectedMaterial:Y,selectedMaterial:c,getMaterials:N}=Q();J(c==null?void 0:c.id);const{openModal:d}=X(),I=B(),[p,R]=o.useState(null),[f,U]=o.useState(null),[q,O]=o.useState(!1),{getCategorizations:D,categorizations:i}=$(),{register:n,formState:{errors:u,dirtyFields:P},handleSubmit:T}=w({defaultValues:F??{id_subcategory:null,description:"",id_unit:null}}),L=async e=>{try{if(l){d("LOADING",{title:"Guardando material",message:"Por favor, espere..."});const{data:a,error:t}=await E.insertOne(e);if(t||!a||!("id"in a))throw new Error("Error al crear oportunidad");d("SUCCESS",{title:"Material creado con éxito",message:"El material se ha creado correctamente."}),N(),I(`/material/${a==null?void 0:a.id}`)}!l&&m&&(d("LOADING",{title:"Actualizando material",message:"Por favor, espere..."}),await W({dirtyFields:Object.fromEntries(Object.entries(P).filter(([a,t])=>typeof t=="boolean")),formData:e,onUpdate:E.update}),d("SUCCESS",{title:"Material actualizado con éxito",message:"El material se ha actualizado correctamente."}))}catch(a){d("ERROR",{title:"Error al actualizar material",message:String(a)})}};o.useEffect(()=>{i||D()},[]);const x=e=>{if(!i)return;const{categories:a}=i;R((a==null?void 0:a.filter(t=>t.id_family===Number(e)))||[])},h=e=>{if(!i)return;const{subcategories:a}=i;U((a==null?void 0:a.filter(t=>t.id_category===Number(e)))||[])},V=e=>{const t=e.target.value;t!==""&&x(Number(t))},G=e=>{const t=e.target.value;t!==""&&h(Number(t))};return o.useEffect(()=>{i&&(!l&&s&&(x(s.id_family),h(s.id_category)),O(!0))},[s,i]),r.jsx(r.Fragment,{children:q&&r.jsxs("form",{className:" flex flex-col gap-6",onSubmit:T(L),children:[r.jsx("fieldset",{disabled:!m,children:r.jsx(k,{title:"Datos del material",children:r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsxs("div",{className:"grid md:grid-cols-3 sm:grid-cols-1 gap-2",children:[r.jsx(g,{id:"id_family",label:"Familia",selectText:"Selecciona familia",onChange:V,defaultValue:l?"":s==null?void 0:s.id_family,error:(S=u.id_subcategory)==null?void 0:S.message,children:(j=i==null?void 0:i.families)==null?void 0:j.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))}),r.jsx(g,{id:"id_category",label:"Rubro",selectText:"Seleccion rubro",onChange:G,error:(y=u.id_subcategory)==null?void 0:y.message,defaultValue:l?"":s==null?void 0:s.id_category,children:p==null?void 0:p.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))}),r.jsx(g,{label:"Sub-rubro",selectText:"Seleccion sub-rubro",...n("id_subcategory",{required:"Campo requerido",valueAsNumber:!0}),error:(v=u.id_subcategory)==null?void 0:v.message,children:f==null?void 0:f.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))})]}),r.jsx(b,{label:"Descripción",placeholder:"Descripción del material",...n("description",{required:"Campo requerido"}),error:(_=u.description)==null?void 0:_.message}),r.jsxs("div",{className:"grid md:grid-cols-2 sm:grid-cols-1 gap-2",children:[r.jsx(K,{label:"Unidad",...n("id_unit",{required:"Campo requerido",valueAsNumber:!0}),error:(C=u.id_unit)==null?void 0:C.message}),r.jsx(b,{label:"Peso",type:"number",placeholder:"Peso en gramos",defaultValue:0,...n("weight",{valueAsNumber:!0})})]}),r.jsx(b,{label:"Aplicación",placeholder:"Aplicación",...n("applycation")})]})})}),r.jsx(H,{isNew:l,isEditMode:m,onToggleEdit:()=>M(e=>!e)})]})})};export{ue as M};
