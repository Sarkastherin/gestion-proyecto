import{s as r,u as m}from"./UIContext-DAvkThde.js";import{r as o}from"./chunk-PVWAREVJ-xN2wnjH-.js";import{u}from"./DataContext-BsNWaLsj.js";function b(s){const{refreshMaterial:t}=u(),e=o.useRef(null),n=500;o.useEffect(()=>{const a=r.channel("realtime:materials_prices");return["materials","prices"].forEach(i=>{a.on("postgres_changes",{event:"*",schema:"public",table:i},l=>{console.log(`[${i.toUpperCase()}] Evento recibido:`,l),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{t(s),e.current=null},n)})}),a.subscribe(),()=>{r.removeChannel(a),e.current&&clearTimeout(e.current)}},[s])}function g(){const{getUnits:s}=u();o.useEffect(()=>{const t=r.channel("realtime:units").on("postgres_changes",{event:"*",schema:"public",table:"units"},()=>{console.log("ejecutando getUnits()"),s()}).subscribe();return()=>{r.removeChannel(t)}},[])}function T(){const{selectedOpportunity:s}=u(),t=o.useRef(null),{getCategorizations:e}=m();o.useEffect(()=>{const n=r.channel("realtime:categorizations_realtime");return["families","categories","subcategories"].forEach(c=>{n.on("postgres_changes",{event:"*",schema:"public",table:c},i=>{console.log(`[${c.toUpperCase()}] Evento recibido:`,i),t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{console.log("refrescando categorias"),e(),t.current=null},500)})}),n.subscribe(),()=>{r.removeChannel(n),t.current&&clearTimeout(t.current)}},[s])}function v(){const{selectedOpportunity:s,refreshOpportunity:t}=u(),e=o.useRef(null);o.useEffect(()=>{if(!s)return;const n=r.channel("realtime:opportunity_realtime");return["opportunities","quotes","details_items","details_materials","phases"].forEach(c=>{n.on("postgres_changes",{event:"*",schema:"public",table:c},i=>{console.log(`[${c.toUpperCase()}] Evento recibido:`,i),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{t(),e.current=null},500)})}),n.subscribe(),()=>{r.removeChannel(n),e.current&&clearTimeout(e.current)}},[])}export{b as a,g as b,T as c,v as u};
