import{r as y,j as t,w as E}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import"./supabaseClient-O5NoNd5h.js";import{u as I}from"./index.esm-CLpX3RIH.js";import{I as R,S as k}from"./Inputs-cvlDeTHR.js";import{u as N}from"./updatesSingleRow-C5gkTyzt.js";import{u as C,a as z}from"./UIContext-9PjeG9pu.js";import{M as q}from"./ModalBase-Czr0Q5I6.js";import{E as A}from"./EntityTable-DKwDIY9O.js";import{b as D}from"./Buttons-ByA9cNaT.js";import{S as O}from"./Containers-ZXGJ7diH.js";import{B as w}from"./Buttons-DjYWmDVV.js";import{u as T,h as U,i as _,j as M,k as $}from"./DataContext-BHROWMOn.js";import{d as B,e as P}from"./realTime-Csd-v9-x.js";import{P as G}from"./ProtectedRoute-DTKDj7Jz.js";import{f as L}from"./allowedRoles-wIcqt93s.js";import"./Link-DZjWQWvu.js";import"./functions-CIXTKjf3.js";import"./TrashIcon-CpHN25SK.js";import"./IconComponent-CkWBZZXK.js";import"./arrow-left-3CO6tBoR.js";import"./ContactsContext-BtjVusI7.js";import"./AuthContext-DiXfFtBN.js";function K({open:s,fields:d,initialValues:n,method:m,onClose:p}){const{openModal:i}=C(),{register:a,handleSubmit:b,reset:h,formState:{errors:j,dirtyFields:x}}=I({defaultValues:n});y.useEffect(()=>{h(n)},[n]);const g=async r=>{try{if(n!=null&&n.id)await N({dirtyFields:x,formData:r,onUpdate:m.update});else{const{error:c}=await m.insertOne(r);if(c)throw new Error(c.message)}i("SUCCESS",{title:"Â¡Todo OK!",message:"Configuracion actualizada",variant:"success"})}catch(c){i("ERROR",{title:"Error al actualizar",message:`No se pudo actualizar la configuraciÃ³n: ${String(c)}`,variant:"error"})}finally{p()}};return s?t.jsx(q,{open:s,title:`${n!=null&&n.id?"Editar":"Agregar"} registro`,onClose:p,zIndex:10,footer:{btnPrimary:{label:"Guardar",handleOnClick:b(g)},btnSecondary:{label:"Cancelar",handleOnClick:p,variant:"light"}},children:t.jsx("form",{className:"space-y-4 mt-4",onSubmit:b(g),children:d.map(r=>{var c;return t.jsxs("div",{children:[r.type==="text"&&t.jsx(R,{label:r.label,...a(r.name,{required:r.required})}),r.type==="boolean"&&t.jsxs("label",{className:"inline-flex gap-2 text-sm items-center",children:[t.jsx("input",{type:"checkbox",...a(r.name)}),r.label]}),r.type==="select"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{htmlFor:r.name,className:"block text-sm font-medium mb-1",children:r.label}),t.jsxs(k,{...a(r.name,{required:r.required}),defaultValue:"",children:[t.jsx("option",{value:"",children:"â€” Seleccionar â€”"}),(c=r.options)==null?void 0:c.map(f=>t.jsx("option",{value:f.value,children:f.label},f.value))]})]})]},r.name)})})}):null}const v=({table:s,title:d,columns:n,formFields:m,data:p,method:i})=>{const{openModal:a}=C(),[b,h]=y.useState(null),[j,x]=y.useState(!1),g=e=>{h(e),x(!0)},r={name:"Eliminar",button:!0,cell:e=>t.jsx(D,{onClick:o=>{o.stopPropagation(),c(e)},children:"Eliminar"}),width:"90px"};async function c(e){if(!confirm("Â¿Eliminar este registro?"))return;const{error:l}=await i.remove({id:e.id});if(l){a("ERROR",{title:"Error",message:`No se pudo eliminar el elemento ${l.message}`,variant:"error"});return}a("SUCCESS",{title:"Â¡Todo Ok!",message:"El elemento fue eliminado",variant:"success"})}const f=()=>{const e=m.filter(o=>o.isInFilter);if(e.length!==0)return e.map(o=>({key:o.name,label:`Buscar por ${o.label}`,autoFilter:!0}))};return t.jsxs("div",{children:[t.jsx("div",{className:"mb-6",children:t.jsx(O,{title:d,back_path:"/settings"})}),t.jsx(A,{columns:[...n,r],data:p,onRowClick:g,filterFields:f()}),t.jsx(K,{open:j,onClose:()=>x(!1),table:s,fields:m,initialValues:b,method:i})]})};function xe({}){return[{title:"Configuraciones"},{name:"Configuraciones",content:"Configuraciones"}]}const W=[{id:"id",name:"Id",selector:s=>s.id,width:"80px"},{name:"Abreviatura",selector:s=>s.abbreviation,width:"180px"},{name:"DescripciÃ³n",selector:s=>s.description}],H=[{id:"id",name:"Id",selector:s=>s.id,width:"80px"},{name:"Familia",selector:s=>s.description}],ge=E(function(){B(),P();const[d,n]=y.useState("unidades"),{units:m,getUnits:p,families:i,categories:a,subcategories:b,getCategories:h,getFamilies:j,getSubcategories:x}=T(),{getCategorizations:g,categorizations:r}=z();y.useEffect(()=>{i||j(),a||h(),b||x(),r||g(),m||p()},[]);const c=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Familia",selector:e=>{var l;return((l=i==null?void 0:i.find(u=>u.id===e.id_family))==null?void 0:l.description)??""},width:"230px"},{name:"Rubro",selector:e=>e.description}],f=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Subrubro",selector:e=>e.description},{name:"Rubro",selector:e=>{var l;return((l=a==null?void 0:a.find(u=>u.id===e.id_category))==null?void 0:l.description)??""}},{name:"Familia",selector:e=>{var u,F;const o=(u=a==null?void 0:a.find(S=>S.id===e.id_category))==null?void 0:u.id_family;return((F=i==null?void 0:i.find(S=>S.id===o))==null?void 0:F.description)??""}}];return t.jsxs(G,{allowed:L,children:[t.jsxs("div",{className:"flex flex-1 min-h-[calc(100vh-64px)]",children:[t.jsxs("div",{className:"flex-1 py-4 mx-auto px-6",children:[d==="unidades"&&t.jsx(v,{table:"units",title:"Unidades",columns:W,data:m||[],method:U,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"abbreviation",label:"Abreviatura",type:"text",required:!0,isInFilter:!1}]}),d==="familias"&&t.jsx(v,{table:"families",title:"Familias",columns:H,data:i||[],method:_,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0}]}),d==="rubros"&&t.jsx(v,{table:"categories",title:"Rubros",columns:c,data:a||[],method:M,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"id_family",label:"Familia",type:"select",options:i==null?void 0:i.map(e=>({value:e.id,label:e.description})),required:!0,isInFilter:!1}]}),d==="subrubros"&&t.jsx(v,{table:"subcategories",title:"Subrubros",columns:f,data:b||[],method:$,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"id_category",label:"Rubro",type:"select",options:a==null?void 0:a.map(e=>{var l;const o=(l=i==null?void 0:i.find(u=>u.id===e.id_family))==null?void 0:l.description;return{value:e.id,label:`${e.description}-[ðŸ§©${o}]`}}),required:!0,isInFilter:!1}]})]}),t.jsx("nav",{className:"w-44 pt-4 space-y-2 border-r border-zinc-300 bg-zinc-200/80 dark:border-zinc-700/60 dark:bg-zinc-900/70 px-4 shadow",children:["unidades","familias","rubros","subrubros"].map((e,o)=>t.jsx(w,{type:"button",onClick:()=>n(e),variant:d===e?"dark":"light",className:"w-full",children:e.charAt(0).toUpperCase()+e.slice(1)},o))})]}),t.jsx("span",{className:"fixed bottom-0 w-full",children:t.jsx("div",{className:"flex justify-start w-full px-10 py-5 hover:bg-zinc-200 hover:dark:bg-zinc-900",children:t.jsx("div",{className:"w-fit",children:t.jsx(w,{variant:"primary",onClick:()=>{},children:"Agregar"})})})})]})});export{ge as default,xe as meta};
