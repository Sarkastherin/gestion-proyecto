import{w as D,u as R,r as m,j as e}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{E as S}from"./EntityTable-CYBYbV-K.js";import{u as P}from"./DataContext-B4mtDhe5.js";import{S as L}from"./Containers-ZXGJ7diH.js";import{P as H}from"./ProtectedRoute-DTKDj7Jz.js";import{f as O}from"./functionsDays-BZooa-Ef.js";import{A as T}from"./allowedRoles-DvcEYYJr.js";import{L as B}from"./LoaderComponent-DzoOhiNN.js";import{u as V}from"./index.esm-CLpX3RIH.js";import{I as h}from"./Inputs-cvlDeTHR.js";import{B as j}from"./Buttons-C61rKE9q.js";import{F as y,M as A}from"./index-Ds5NNZRZ.js";import{R as I}from"./receipt-CJvoXreP.js";import"./UIContext-9PjeG9pu.js";import"./supabaseClient-O5NoNd5h.js";import"./Buttons-dijALP0_.js";import"./index-DvKACyVh.js";import"./functions-llu_GUtd.js";import"./TrashIcon-CpHN25SK.js";import"./ContactsContext-BtjVusI7.js";import"./IconComponent-CkWBZZXK.js";import"./arrow-left-3CO6tBoR.js";import"./AuthContext-DiXfFtBN.js";import"./iconBase-C9B2YtSF.js";function he({}){return[{title:"Consolidado de horas por operario"},{name:"description",content:"Consolidado de horas por operario"}]}const M=[{name:"Empleado",selector:r=>r.employee_name||"",sortable:!0},{name:"Horas equivalentes",selector:r=>r.total_equivalent_hours,sortable:!0,width:"150px"},{name:"Días equivalentes",selector:r=>r.total_equivalent_days,sortable:!0,width:"150px"},{name:"Viáticos",selector:r=>r.total_viaticum,sortable:!0,width:"120px"},{name:"Comidas",selector:r=>r.alimentation,sortable:!0,width:"120px"}],be=D(function(){const g=R(),{getLiquidationReport:q,liquidationReport:d}=P(),{register:u,handleSubmit:N,getValues:b}=V();m.useEffect(()=>{d||q()},[]);const[x,w]=m.useState(null),[c,k]=m.useState({total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0}),p=o=>{var f,_;const a={};if(!d)return;let i=d;if((f=o==null?void 0:o.filters)!=null&&f.employee_name&&(i=i.filter(t=>{var s,l;return(l=(s=t.employee)==null?void 0:s.contacto_nombre)==null?void 0:l.toLowerCase().includes(o.filters.employee_name.toLowerCase())})),(_=o==null?void 0:o.filters)!=null&&_.from){const t=new Date(o.filters.from).getTime(),s=o.filters.to?new Date(o.filters.to).getTime():1/0;i=i.filter(l=>new Date(l.date_report).getTime()>=t&&new Date(l.date_report).getTime()<=s)}i.forEach(t=>{var v;const s=((v=t.employee)==null?void 0:v.contacto_nombre)||"Desconocido";a[s]||(a[s]={employee_name:s,total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0,projects:[]}),a[s].total_equivalent_hours+=t.equivalent_hours??0,a[s].total_equivalent_hours=parseFloat(a[s].total_equivalent_hours.toFixed(2)),t.viaticum&&(a[s].total_viaticum+=1),t.equivalent_hours&&(a[s].total_equivalent_days+=t.equivalent_hours/9),a[s].total_equivalent_days=parseFloat(a[s].total_equivalent_days.toFixed(2)),t.absent||(a[s].alimentation+=1);const l=a[s].projects.find(C=>C.project_name===t.project_name);l?(l.equivalent_hours+=t.equivalent_hours??0,l.equivalent_days+=t.equivalent_hours?parseFloat(((t.equivalent_hours??0)/9).toFixed(2)):0,l.alimentation+=t.absent?0:1,t.viaticum&&(l.viaticum+=1),l.dayReport.push(t)):a[s].projects.push({project_name:t.project_name||"Desconocido",equivalent_hours:t.equivalent_hours??0,viaticum:t.viaticum?1:0,dayReport:[t],equivalent_days:t.equivalent_hours?parseFloat(((t.equivalent_hours??0)/9).toFixed(2)):0,alimentation:t.absent?0:1})});const n={total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0};Object.values(a).forEach(t=>{n.total_equivalent_hours+=t.total_equivalent_hours,n.total_viaticum+=t.total_viaticum,n.total_equivalent_days+=t.total_equivalent_days,n.alimentation+=t.alimentation}),k(n),w(Object.values(a))};m.useEffect(()=>{d&&p()},[d]);const z=({data:o})=>e.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-800/40",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Proyectos de ",o.employee_name]}),o.projects.map(a=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-medium mb-1",children:a.project_name}),e.jsxs("p",{children:["Horas equivalentes: ",a.equivalent_hours]}),e.jsxs("p",{children:["Viáticos: ",a.viaticum]}),e.jsx("details",{className:"mt-2",children:e.jsxs("table",{className:"w-full text-left border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-blue-700 dark:text-blue-300 font-medium",children:[e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Fecha"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"HS-EQ"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Días EQ"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Viático"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Comida"})]})}),e.jsx("tbody",{children:a.dayReport.map(i=>{var n;return e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:O(i.date_report)}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:((n=i.equivalent_hours)==null?void 0:n.toFixed(2))||"0"}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:(i.equivalent_hours?i.equivalent_hours/9:0).toFixed(2)}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:i.viaticum?"Sí":"No"}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:i.absent?"No":"Sí"})]},i.id)})})]})})]},a.project_name))]}),F=o=>{p({filters:o})},E=()=>{g("/rrhh/consolidated_hours_per_worker/pdf",{state:{data:x,globalBalance:c,periodo:{from:b("from"),to:b("to")}}})};return x?e.jsx(H,{allowed:T,children:e.jsxs("div",{className:"flex flex-1 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"w-full overflow-x-auto py-4 px-4 lg:px-10",children:[e.jsx("div",{className:"my-4",children:e.jsx(L,{title:"Consolidado de horas por operario",back_path:"/rrhh",IconComponent:{component:I,color:"text-yellow-600"}})}),e.jsxs("form",{onSubmit:N(F),className:"flex flex-col lg:flex-row gap-2 lg:gap-4 items-stretch lg:items-end w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{label:"Filtrar por empleado",...u("employee_name")})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h,{label:"Desde",type:"date",...u("from")}),e.jsx("span",{className:"text-sm",children:"a"}),e.jsx(h,{type:"date",label:"Hasta",...u("to")})]}),e.jsx(j,{type:"submit",icon:{component:y,color:""},children:"Filtrar"})]}),e.jsx("div",{className:"w-full lg:w-auto hidden",children:e.jsx(j,{type:"submit",icon:{component:y,color:""},children:"Filtrar"})})]}),e.jsx(S,{data:x,columns:M,expandableRows:!0,disableRowClick:!0,ExpandedComponent:z,buttonOnClick:{title:"Reporte en PDF",color:"red",onClick:E,icon:{component:A,color:"text-white"}}})]}),e.jsxs("div",{className:"hidden md:flex flex-col items-center w-54 pt-10 border-r border-zinc-300 bg-white dark:border-zinc-700/60 dark:bg-zinc-900/70 px-4 shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-yellow-700 dark:text-yellow-500 flex items-center",children:e.jsx("span",{children:"Balance global"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-400 mb-1",children:"Horas equivalentes"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_equivalent_hours.toFixed(2)})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300 mb-1",children:"Días equivalentes"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_equivalent_days.toFixed(2)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300 mb-1",children:"Viáticos"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_viaticum})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-pink-700 dark:text-pink-300 mb-1",children:"Alimentación"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.alimentation})]})]})]})]})}):e.jsx(B,{})});export{be as default,he as meta};
