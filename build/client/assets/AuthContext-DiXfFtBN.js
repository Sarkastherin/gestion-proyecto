import{r as o,j as f}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{s as r}from"./supabaseClient-O5NoNd5h.js";const i=o.createContext(void 0),w=()=>{const n=o.useContext(i);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},A=({children:n})=>{const[c,h]=o.useState(null),[a,u]=o.useState(null),d=async()=>{r.auth.getSession().then(({data:{session:s}})=>{u(s)});const{data:{subscription:t}}=r.auth.onAuthStateChange((s,e)=>{u(e)});return a&&l(a.user.id),()=>t.unsubscribe()},l=async t=>{try{const{data:s,error:e}=await r.from("users").select("*, roles:id_rol(name)").eq("auth_user_id",t).single();if(e){alert(`No se pudo acceder al servidor: Error: ${e.message}`);return}h(s);return}catch(s){console.error("Error fetching user:",s);return}},g=async({email:t,password:s})=>{const{data:e,error:x}=await r.auth.signInWithPassword({email:t,password:s});return{data:e,error:x}},m=async()=>{const{error:t}=await r.auth.signOut();return t||null};return f.jsx(i.Provider,{value:{user:c,session:a,signIn:g,signOut:m,auth:d},children:n})};export{A,w as u};
