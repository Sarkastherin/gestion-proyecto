import{r as d,j as e}from"./chunk-PVWAREVJ-xN2wnjH-.js";import{S as z,I as c,T}from"./Inputs-nFJy7MmX.js";import{a as R,C as q}from"./Cards-BrE1Rw6C.js";import{u as I}from"./index.esm-BDlKQGcf.js";import{u as O}from"./UIContext-CTPOFttf.js";import{q as P}from"./cruds-C8awoSIz.js";import{F as G}from"./FooterForms-D8IvpDVX.js";import{u as V}from"./updatesSingleRow-BjGTgUib.js";import{u as B}from"./fieldsChange-uPUKat4f.js";import{u as Q}from"./DataContext-BJsy23hk.js";import{u as H}from"./ModalsContext-CDMOE33t.js";const J=[{description:"15 días fecha de factura por transferencia bancaria"},{description:"15 días fecha de factura por e-cheq a 15 días"},{description:"30 días fecha de factura por transferencia bancaria"},{description:"30 días fecha de factura por e-cheq a 15 días"},{description:"contra envio de factura por transferencia bancaria"},{description:"contra envio de factura por e-cheq a 15 días"},{description:"contra envio de factura por e-cheq a 30 días"},{description:"Otro"}];function he({quoteActive:m}){var x,u,g,j,w,y,f,_,b,N;const[o,U]=d.useState(!1),{openModal:p}=H(),{editByStatus:s}=O(),{selectedOpportunity:A}=Q(),{quotes:n}=A||{},{register:r,formState:{dirtyFields:D,isSubmitSuccessful:F,isDirty:E},handleSubmit:L,reset:M,watch:t,setValue:h}=I({defaultValues:{}}),$=async a=>{p("LOADING");try{const{t_mg_materials:i,t_mg_labor:S,t_mg_subcontracting:C,t_mg_others:k,total:v,total_materials:K,total_labor:W,total_subcontracting:X,total_others:Y,t_mg_total:Z,...ee}=a;await V({dirtyFields:D,formData:a,onUpdate:P.update}),p("SUCCESS",{message:"Oportunidad actualizada correctamente"})}catch(i){p("ERROR",{message:`No se pudo actualizar la oportunidad. Error: ${String(i)}`})}};B({isSubmitSuccessful:F,isDirty:E}),d.useEffect(()=>{const a=n==null?void 0:n.find(i=>i.id===m);a&&M(a)},[n,m]);const l=(a,i,S)=>{const C=t(a),v=t(i)??0;h(S,C*(1+v/100))};return d.useEffect(()=>{const a=t("t_mg_materials")+t("t_mg_labor")+t("t_mg_subcontracting")+t("t_mg_others");h("total",a)},[t("t_mg_materials"),t("t_mg_labor"),t("t_mg_subcontracting"),t("t_mg_others")]),d.useEffect(()=>{const a=t("general")??0,i=t("total")*(1+a/100);h("t_mg_total",i)},[t("total")]),e.jsx(e.Fragment,{children:e.jsxs("form",{className:" flex flex-col gap-6",onSubmit:L($),children:[e.jsx("fieldset",{disabled:!o,children:e.jsx(R,{title:"Formas y metodos de pago",children:e.jsxs("div",{className:"grid lg:grid-cols-2 md:grid-cols-1 gap-2",children:[e.jsx(z,{disabled:!s,label:"Forma de pago",...r("method_payment",{required:!0}),children:J.map(a=>e.jsx("option",{value:a.description,children:a.description},a.description))}),e.jsx(c,{disabled:!s,placeholder:"Plazo de ejecución",label:"Plazo de ejecución",...r("delivery_time")}),e.jsx(c,{disabled:!s,placeholder:"Garantía",label:"Garantía",...r("guarantee")}),e.jsx(c,{disabled:!s,type:"date",placeholder:"Vigencia",label:"Vigencia",...r("validity")}),e.jsx(c,{disabled:!s,type:"date",placeholder:"Fecha probable de inicio",label:"Fecha probable de inicio",...r("estimated_start_date")}),e.jsxs(z,{disabled:!s,label:"Status",...r("status",{required:!0}),children:[e.jsx("option",{value:"",children:"Seleccione un status"}),[{description:"Abierta"},{description:"Cerrada"}].map(a=>e.jsx("option",{value:a.description,children:a.description},a.description))]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(T,{disabled:!s,label:"Notas de Cotización",placeholder:"Notas de Cotización",rows:2,...r("notes")})})]})})}),e.jsx("fieldset",{disabled:!o,children:e.jsx(R,{title:"Margenes de Ganancias",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto divide-y-2 divide-zinc-200 dark:divide-zinc-700",children:[e.jsxs("colgroup",{children:[e.jsx("col",{}),e.jsx("col",{className:"w-[1%]"}),e.jsx("col",{className:"w-[1%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[1%]"})]}),e.jsx("thead",{className:"ltr:text-left rtl:text-right",children:e.jsxs("tr",{className:"*:font-medium *:text-zinc-900 dark:*:text-white",children:[e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Categoria de Cotización"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"INC %"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Márgen/Comp"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total con M/S"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-700",children:[e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Materiales"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((x=t("total_materials"))==null?void 0:x.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(c,{disabled:!s,placeholder:"0 %",...r("materials",{onChange:a=>l("total_materials","materials","t_mg_materials")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((u=t("t_mg_materials"))==null?void 0:u.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Mano de obra"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((g=t("total_labor"))==null?void 0:g.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(c,{disabled:!s,placeholder:"0%",...r("labor",{onChange:a=>l("total_labor","labor","t_mg_labor")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((j=t("t_mg_labor"))==null?void 0:j.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Subcontratos"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((w=t("total_subcontracting"))==null?void 0:w.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(c,{disabled:!s,placeholder:"0%",...r("subcontracting",{onChange:a=>l("total_subcontracting","subcontracting","t_mg_subcontracting")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((y=t("t_mg_subcontracting"))==null?void 0:y.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Otros"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((f=t("total_others"))==null?void 0:f.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(c,{disabled:!s,placeholder:"0%",...r("others",{onChange:a=>l("total_others","others","t_mg_others")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((_=t("t_mg_others"))==null?void 0:_.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]})]})]})})})}),e.jsx("fieldset",{disabled:!o,children:e.jsx(q,{children:e.jsxs("table",{className:"min-w-full table-auto ",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[4%]"}),e.jsx("col",{className:"w-[1%]"})]}),e.jsx("thead",{className:"ltr:text-left rtl:text-right",children:e.jsxs("tr",{className:"*:font-medium *:text-zinc-900 dark:*:text-white",children:[e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Márgen final"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Precio final"})]})}),e.jsx("tbody",{className:"",children:e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((b=t("total"))==null?void 0:b.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(c,{disabled:!s,placeholder:"0%",...r("general",{valueAsNumber:!0,onChange:a=>l("total","general","t_mg_total")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((N=t("t_mg_total"))==null?void 0:N.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]})})]})})}),e.jsx(G,{isNew:!1,isEditMode:o,onToggleEdit:()=>U(a=>!a)})]})})}export{he as C,J as f};
