import{w as N,a as O,b as S,u as w,r as f,j as t,O as P}from"./chunk-PVWAREVJ-xN2wnjH-.js";import{u as Q}from"./UIContext-CTPOFttf.js";import{S as _}from"./SectionCreateQuote-D_PQE6L6.js";import{S as q}from"./Inputs-nFJy7MmX.js";import{B as $}from"./Buttons-BBIplumE.js";import{u as E}from"./realTime-CHJ-WwWR.js";import{u as F}from"./DataContext-BJsy23hk.js";function G({}){return[{title:"Oportunidad [Cotizaciones]"},{name:"description",content:"Oportunidad [Cotizaciones]"}]}const T=[{key:"materiales",label:"Materiales"},{key:"mano de obra",label:"Mano de Obra"},{key:"subcontratos",label:"Subcontratos"},{key:"otros",label:"Otros"}],H=N(function(){E();const{selectedQuoteId:n}=O(),{id:h}=S(),m=w(),[o,l]=f.useState("materiales"),{selectedPhase:x,setSelectedPhase:i,isFieldsChanged:p,setIsFieldsChanged:y}=Q(),{selectedOpportunity:g}=F(),{phases:r,quotes:c,details_materials:u,details_items:d}=g||{},b=(c==null?void 0:c.length)===0,v=e=>{const a=`opportunity/${h}/quotes/${e.key==="materiales"?"materials":"items"}`;p?confirm("Tienes cambios sin guardar, Â¿deseas continuar?")&&(y(!1),m(a),l(e.key)):(m(a),l(e.key))},j=e=>{const s=e.target.value;i(Number(s))};return f.useEffect(()=>{if(!n)return;const e=u==null?void 0:u.filter(s=>s.id_quote===n),a=d==null?void 0:d.filter(s=>s.id_quote===n);if(o==="materiales"&&e&&e.length>0){const s=e[0].id_phase??null;i(s||null)}else if(o!=="materiales"&&a&&a.length>0){const s=a.find(k=>k.type===o),C=(s==null?void 0:s.id_phase)??null;i(C||null)}else i(null)},[o,n]),t.jsx(t.Fragment,{children:b?t.jsx(_,{}):n&&t.jsxs("div",{className:"w-full px-8 mt-8 mx-auto pb-18",children:[t.jsxs("section",{className:"flex gap-4",children:[t.jsx("div",{className:"w-2/3",children:t.jsx(q,{value:String(x),id:"id_phase",onChange:e=>j(e),disabled:p,children:r==null?void 0:r.map(e=>t.jsx("option",{value:e.id,children:`[${e.id}] ${e.name}`},e.id))})}),t.jsx("div",{className:"w-full flex gap-2",children:T.map(e=>t.jsx("div",{className:"w-1/4",children:t.jsx($,{type:"button",onClick:()=>v(e),variant:o===e.key?"primary":"secondary",className:"w-full",children:e.label})},e.key))})]}),t.jsx(P,{context:{selectedQuoteId:n,activeType:o,setActiveType:l}})]})})});export{G as m,H as q,T as t};
