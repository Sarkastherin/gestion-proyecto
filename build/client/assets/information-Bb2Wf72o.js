import{r as v,j as e,w}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{a as M}from"./Containers-ZXGJ7diH.js";import{u as q}from"./index.esm-CLpX3RIH.js";import{a as N}from"./Cards-BPIQ6iiA.js";import{I as n,T as R,S as I}from"./Inputs-cvlDeTHR.js";import{F as A}from"./FooterForms-CbBXM1X1.js";import{a as T,u as O}from"./UIContext-9PjeG9pu.js";import{u as U}from"./useModalState-Dynfoma4.js";import{f as V}from"./ConditionsForm-Dro3_idw.js";import{u as L}from"./updatesSingleRow-C5gkTyzt.js";import{f as k,u as z}from"./DataContext-BHROWMOn.js";import{w as G}from"./functionsDays-BZooa-Ef.js";import{a as $}from"./realTime-Csd-v9-x.js";import"./IconComponent-CkWBZZXK.js";import"./arrow-left-3CO6tBoR.js";import"./Buttons-DjYWmDVV.js";import"./supabaseClient-O5NoNd5h.js";import"./fieldsChange-DvNB-iS-.js";import"./ContactsContext-BtjVusI7.js";import"./functions-CIXTKjf3.js";function B({defaultValues:p}){var j,x,_,h,b,S,y;const[s,u]=v.useState(!1),{selectedClient:i}=T(),f=U(),{openModal:d}=O(),{register:r,handleSubmit:E,watch:t,setValue:g,formState:{errors:o,dirtyFields:F}}=q({defaultValues:p}),P=async a=>{d("LOADING");try{await L({dirtyFields:F,formData:a,onUpdate:k.update}),d("SUCCESS",{message:"Proyecto actualizado correctamente"})}catch(l){d("ERROR",{message:`No se pudo actualizar el proyecto. Error: ${String(l)}`})}},C=[{mode:"Sin descanso",description:"Sin descanso",value:"0000000"},{mode:"1 día descanso por semana",description:"1 día descanso por semana",value:"0000010"},{mode:"2 días descanso por semana",description:"2 días descanso por semana",value:"0000011"}];return v.useEffect(()=>{const a=t("plan_start_date")??"",l=t("plan_duration"),c=parseInt(l!==void 0?String(l):"0"),m=t("mode");if(c<=0||isNaN(c)||a===""||m===""||m===null){g("plan_end_date","");return}const D=G(a,c,m).toLocaleDateString("sv-SE");g("plan_end_date",D)},[t("plan_start_date"),t("plan_duration"),t("mode")]),e.jsxs("form",{className:" flex flex-col gap-6",onSubmit:E(P),children:[e.jsx("fieldset",{disabled:!s,children:e.jsx(N,{title:"Datos del Proyecto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Nombre del Proyecto",...r("name",{required:"Campo requerido"}),error:(j=o.name)==null?void 0:j.message}),e.jsx(n,{label:"Cliente",placeholder:"Seleccione un cliente",readOnly:!0,value:(i==null?void 0:i.nombre)||"",onClick:()=>{f.openModal()},error:(x=o.id_client)==null?void 0:x.message}),e.jsx("input",{type:"hidden",...r("id_client",{required:!0,valueAsNumber:!0})}),e.jsx("div",{className:"col-span-2",children:e.jsx(R,{label:"Alcance",...r("scope")})})]})})}),e.jsx("fieldset",{disabled:!s,children:e.jsx(N,{title:"Detalles adicionales",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-3 sr-only",children:e.jsx(I,{label:"Forma de pago",...r("method_payment"),children:V.map(a=>e.jsx("option",{value:a.description,children:a.description},a.description))})}),e.jsx("div",{className:"col-span-3 sr-only",children:e.jsx(n,{label:"Garantía",...r("guarantee"),error:(_=o.guarantee)==null?void 0:_.message})}),e.jsx(n,{label:"Fecha de inicio [Plan]",type:"date",...r("plan_start_date"),error:(h=o.plan_start_date)==null?void 0:h.message}),e.jsx(n,{label:"Duración [Plan]",type:"number",defaultValue:1,...r("plan_duration",{valueAsNumber:!0,min:{value:1,message:"La duración debe ser al menos 1 día"},required:"Campo requerido"}),error:(b=o.plan_duration)==null?void 0:b.message}),e.jsx(I,{label:"Modalidad",...r("mode",{required:"Campo requerido"}),error:(S=o.mode)==null?void 0:S.message,children:C.map(a=>e.jsx("option",{value:a.value,children:a.description},a.description))}),e.jsx(n,{readOnly:!0,label:"Fecha de fin [Plan]",type:"date",...r("plan_end_date"),error:(y=o.plan_end_date)==null?void 0:y.message})]})})}),e.jsx(A,{isNew:!1,isEditMode:s,onToggleEdit:()=>u(a=>!a)})]})}function pe({}){return[{title:"Información"},{name:"description",content:"Información del proyecto"}]}const ue=w(function(){$();const{selectedProject:s}=z();if(!s)return null;const{phases_project:u,budget_details_items:i,budget_details_materials:f,client:d,...r}=s;return e.jsx(M,{children:e.jsx(B,{defaultValues:r})})});export{ue as default,pe as meta};
