import{r as g,j as t,w as E}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{u as D}from"./index.esm-CLpX3RIH.js";import{I as _,S as M}from"./Inputs-cvlDeTHR.js";import{u as R}from"./updatesSingleRow-C5gkTyzt.js";import{u as F,a as A}from"./UIContext-9PjeG9pu.js";import{M as z}from"./ModalBase-CQji_mgJ.js";import{b as N}from"./Buttons-dijALP0_.js";import{E as q}from"./EntityTable-CYBYbV-K.js";import{S as L}from"./Containers-ZXGJ7diH.js";import{B as O}from"./Buttons-C61rKE9q.js";import{u as T,h as U,i as $,j as B,k as P}from"./DataContext-B4mtDhe5.js";import{d as Z,e as G}from"./realTime-VCRs_Sia.js";import{P as K}from"./ProtectedRoute-DTKDj7Jz.js";import{f as W}from"./allowedRoles-DvcEYYJr.js";import{c as j}from"./arrow-left-3CO6tBoR.js";import"./supabaseClient-O5NoNd5h.js";import"./index-DvKACyVh.js";import"./functions-llu_GUtd.js";import"./TrashIcon-CpHN25SK.js";import"./IconComponent-CkWBZZXK.js";import"./ContactsContext-BtjVusI7.js";import"./AuthContext-DiXfFtBN.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]],J=j("boxes",H);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M13 13.74a2 2 0 0 1-2 0L2.5 8.87a1 1 0 0 1 0-1.74L11 2.26a2 2 0 0 1 2 0l8.5 4.87a1 1 0 0 1 0 1.74z",key:"15q6uc"}],["path",{d:"m20 14.285 1.5.845a1 1 0 0 1 0 1.74L13 21.74a2 2 0 0 1-2 0l-8.5-4.87a1 1 0 0 1 0-1.74l1.5-.845",key:"byia6g"}]],X=j("layers-2",Q);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],V=j("layers",Y);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],te=j("ruler",ee);function ae({open:x,fields:d,initialValues:s,method:m,onClose:u}){const{openModal:r}=F(),{register:i,handleSubmit:p,reset:y,formState:{errors:k,dirtyFields:f}}=D({defaultValues:s});g.useEffect(()=>{y(s)},[s]);const h=async a=>{try{if(s!=null&&s.id)await R({dirtyFields:f,formData:a,onUpdate:m.update});else{const{error:l}=await m.insertOne(a);if(l)throw new Error(l.message)}r("SUCCESS",{title:"Â¡Todo OK!",message:"Configuracion actualizada",variant:"success"})}catch(l){r("ERROR",{title:"Error al actualizar",message:`No se pudo actualizar la configuraciÃ³n: ${String(l)}`,variant:"error"})}finally{u()}};return x?t.jsx(z,{open:x,title:`${s!=null&&s.id?"Editar":"Agregar"} registro`,onClose:u,zIndex:10,footer:{btnPrimary:{label:"Guardar",handleOnClick:p(h)},btnSecondary:{label:"Cancelar",handleOnClick:u,variant:"light"}},children:t.jsx("form",{className:"space-y-4 mt-4",onSubmit:p(h),children:d.map(a=>{var l;return t.jsxs("div",{children:[a.type==="text"&&t.jsx(_,{label:a.label,...i(a.name,{required:a.required})}),a.type==="boolean"&&t.jsxs("label",{className:"inline-flex gap-2 text-sm items-center",children:[t.jsx("input",{type:"checkbox",...i(a.name)}),a.label]}),a.type==="select"&&t.jsxs(t.Fragment,{children:[t.jsx("label",{htmlFor:a.name,className:"block text-sm font-medium mb-1",children:a.label}),t.jsxs(M,{...i(a.name,{required:a.required}),defaultValue:"",children:[t.jsx("option",{value:"",children:"â€” Seleccionar â€”"}),(l=a.options)==null?void 0:l.map(b=>t.jsx("option",{value:b.value,children:b.label},b.value))]})]})]},a.name)})})}):null}const v=({value:x,title:d,columns:s,formFields:m,data:u,method:r,icon:i,headers:p})=>{const{openModal:y}=F(),[k,f]=g.useState(null),[h,a]=g.useState(!1);function l(){f(null),a(!0)}const b=n=>{f(n),a(!0)},S={name:"Eliminar",button:!0,cell:n=>t.jsx(N,{onClick:o=>{o.stopPropagation(),w(n)},children:"Eliminar"}),width:"90px"};async function w(n){if(!confirm("Â¿Eliminar este registro?"))return;const{error:c}=await r.remove({id:n.id});if(c){y("ERROR",{title:"Error",message:`No se pudo eliminar el elemento ${c.message}`,variant:"error"});return}y("SUCCESS",{title:"Â¡Todo Ok!",message:"El elemento fue eliminado",variant:"success"})}const e=()=>{const n=m.filter(o=>o.isInFilter);if(n.length!==0)return n.map(o=>({key:o.name,label:`Buscar por ${o.label}`,autoFilter:!0}))};return t.jsxs("div",{children:[t.jsx("div",{className:"my-4",children:t.jsx(L,{title:d,back_path:"/settings",IconComponent:{component:i,color:"text-orange-500"}})}),t.jsx(q,{columns:[...s,S],data:u,onRowClick:b,filterFields:e(),buttonExport:{headers:p,filename:`${d}`,type:x},buttonOnClick:{onClick:l,title:"Agregar",color:"orange"}}),t.jsx(ae,{open:h,onClose:()=>a(!1),fields:m,initialValues:k,method:r})]})};function Ie({}){return[{title:"Configuraciones"},{name:"Configuraciones",content:"Configuraciones"}]}const Ce=E(function(){Z(),G();const[d,s]=g.useState("unidades"),{units:m,getUnits:u,families:r,categories:i,subcategories:p,getCategories:y,getFamilies:k,getSubcategories:f}=T(),{getCategorizations:h,categorizations:a}=A();g.useEffect(()=>{r||k(),i||y(),p||f(),a||h(),m||u()},[]);const l=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Abreviatura",selector:e=>e.abbreviation,width:"180px"},{name:"DescripciÃ³n",selector:e=>e.description}],b=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Familia",selector:e=>e.description}],S=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Familia",selector:e=>{var o;return((o=r==null?void 0:r.find(c=>c.id===e.id_family))==null?void 0:o.description)??""},width:"230px"},{name:"Rubro",selector:e=>e.description}],w=[{id:"id",name:"Id",selector:e=>e.id,width:"80px"},{name:"Subrubro",selector:e=>e.description},{name:"Rubro",selector:e=>{var o;return((o=i==null?void 0:i.find(c=>c.id===e.id_category))==null?void 0:o.description)??""}},{name:"Familia",selector:e=>{var c,C;const n=(c=i==null?void 0:i.find(I=>I.id===e.id_category))==null?void 0:c.id_family;return((C=r==null?void 0:r.find(I=>I.id===n))==null?void 0:C.description)??""}}];return t.jsx(K,{allowed:W,children:t.jsxs("div",{className:"flex flex-1 min-h-[calc(100vh-64px)]",children:[t.jsxs("div",{className:"flex-1 py-4 px-10 mx-auto",children:[d==="unidades"&&t.jsx(v,{value:"unidades",title:"Unidades",columns:l,data:m||[],method:U,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"abbreviation",label:"Abreviatura",type:"text",required:!0,isInFilter:!1}],icon:te,headers:[{key:"id",label:"ID"},{key:"description",label:"DescripciÃ³n"},{key:"abbreviation",label:"Abreviatura"}]}),d==="familias"&&t.jsx(v,{value:"familias",title:"Familias",columns:b,data:r||[],method:$,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0}],icon:J,headers:[{key:"id",label:"ID"},{key:"description",label:"DescripciÃ³n"}]}),d==="rubros"&&t.jsx(v,{value:"rubros",title:"Rubros",columns:S,data:i||[],method:B,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"id_family",label:"Familia",type:"select",options:r==null?void 0:r.map(e=>({value:e.id,label:e.description})),required:!0,isInFilter:!1}],icon:X,headers:[{key:"id",label:"ID"},{key:"description",label:"DescripciÃ³n"},{key:"id_family",label:"ID familia"}]}),d==="subrubros"&&t.jsx(v,{value:"subrubros",title:"Subrubros",columns:w,data:p||[],method:P,formFields:[{name:"description",label:"DescripciÃ³n",type:"text",required:!0,isInFilter:!0},{name:"id_category",label:"Rubro",type:"select",options:i==null?void 0:i.map(e=>{var o;const n=(o=r==null?void 0:r.find(c=>c.id===e.id_family))==null?void 0:o.description;return{value:e.id,label:`${e.description}-[ðŸ§©${n}]`}}),required:!0,isInFilter:!1}],icon:V,headers:[{key:"id",label:"ID"},{key:"description",label:"DescripciÃ³n"},{key:"id_category",label:"ID rubro"}]})]}),t.jsx("nav",{className:"w-44 pt-4 space-y-2 border-r border-zinc-300 bg-zinc-200/80 dark:border-zinc-700/60 dark:bg-zinc-900/70 px-4 shadow",children:["unidades","familias","rubros","subrubros"].map((e,n)=>t.jsx(O,{type:"button",onClick:()=>s(e),variant:d===e?"dark":"light",className:"w-full",children:e.charAt(0).toUpperCase()+e.slice(1)},n))})]})})});export{Ce as default,Ie as meta};
