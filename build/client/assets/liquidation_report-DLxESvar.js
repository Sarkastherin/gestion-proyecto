import{w as m,r as d,j as r}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{E as f}from"./EntityTable-DKwDIY9O.js";import{u as y}from"./DataContext-BHROWMOn.js";import{C as h}from"./Containers-ZXGJ7diH.js";import{P as b}from"./ProtectedRoute-DTKDj7Jz.js";import{f as x}from"./functionsDays-BZooa-Ef.js";import{F as H}from"./FooterUITable-C66h8R_K.js";import{a as _}from"./Buttons-ByA9cNaT.js";import{A as k}from"./allowedRoles-wIcqt93s.js";import{L as T}from"./LoaderComponent-DzoOhiNN.js";import{R as E}from"./receipt-CJvoXreP.js";import"./Inputs-cvlDeTHR.js";import"./Buttons-DjYWmDVV.js";import"./IconComponent-CkWBZZXK.js";import"./UIContext-9PjeG9pu.js";import"./supabaseClient-O5NoNd5h.js";import"./ContactsContext-BtjVusI7.js";import"./functions-CIXTKjf3.js";import"./arrow-left-3CO6tBoR.js";import"./AuthContext-DiXfFtBN.js";import"./Link-DZjWQWvu.js";import"./TrashIcon-CpHN25SK.js";const j={weekday:[{upToHours:9,factor:1},{upToHours:13.5,factor:1.5},{upToHours:18,factor:2},{upToHours:1/0,factor:2}],saturday:[{upToHours:4,factor:1},{upToHours:9,factor:1.5},{upToHours:13.5,factor:2},{upToHours:1/0,factor:2}],sundayOrHoliday:[{upToHours:9,factor:2},{upToHours:13.5,factor:3},{upToHours:18,factor:3.5},{upToHours:1/0,factor:3.5}]};function w(e,t){const o=typeof e=="string"?new Date(e):e,a=typeof e=="string"?e:o.toISOString().split("T")[0];if(t.some(i=>i.date===a))return"sundayOrHoliday";const s=o.getDay();return s===0?"sundayOrHoliday":s===6?"saturday":"weekday"}function g(e,t,o){if(e<=0)return 0;const a=w(t,o),u=j[a];let s=0,i=e,c=0;for(const n of u){if(i<=0)break;const l=n.upToHours-c,p=Math.min(i,l);s+=p*n.factor,i-=p,c=n.upToHours}return Math.round(s*100)/100}function V({}){return[{title:"Asistencias"},{name:"description",content:"Asistencias"}]}const F=[{name:"Id",selector:e=>e.id,width:"80px",sortable:!0},{name:"Fecha",selector:e=>x(e.date_report)||"",sortable:!0,width:"130px"},{name:"Empleado",selector:e=>{var t;return((t=e.employee)==null?void 0:t.contacto_nombre)||""},sortable:!0},{name:"Entrada",selector:e=>e.hour_start||"",sortable:!0,width:"120px"},{name:"Salida",selector:e=>e.hour_end||"",sortable:!0,width:"120px"},{name:"Total horas",selector:e=>{var t;return((t=e.hours_worked)==null?void 0:t.toFixed(2))||"0"},sortable:!0,width:"150px"},{name:"Horas equiv",selector:e=>e.equivalent_hours??0,sortable:!0,width:"150px"},{name:"Proyecto",selector:e=>e.project_name||"",sortable:!0}],X=m(function(){const{getReportsEmployees:t,reportsEmployees:o,holidays:a,getHolidays:u}=y();d.useEffect(()=>{o||t(),a||u()},[]);const[s,i]=d.useState(o??[]);d.useEffect(()=>{if(o&&a){const n=o.map(l=>{const p=g(l.hours_worked??0,l.date_report,a);return{...l,equivalent_hours:p}});i(n)}},[o,a]);const c=[{label:"ID",key:"id"},{label:"Fecha",key:"date_report"},{label:"Empleado",key:"employee.contacto_nombre"},{label:"Asistencia",key:"absent"},{label:"Entrada",key:"hour_start"},{label:"Salida",key:"hour_end"},{label:"Proyecto",key:"project_name"}];return!o||!a?r.jsx(T,{}):r.jsxs(b,{allowed:k,children:[r.jsx(h,{title:"Liquidaci√≥n de sueldos",width:"w-full",back_path:"/rrhh",IconComponent:{component:E,color:"text-green-600"},children:r.jsx(f,{data:s,columns:F,onFilteredChange:i,filterFields:[{key:"employee.contacto_nombre",label:"Nombre del empleado",autoFilter:!0},{key:"absent",label:"Asistencia",type:"select",options:r.jsxs(r.Fragment,{children:[r.jsx("option",{value:"true",children:"Ausente"}),r.jsx("option",{value:"false",children:"Presente"})]}),autoFilter:!0},{key:"project_name",label:"Proyecto",autoFilter:!0},{key:"date_report",label:"Fecha",type:"dateRange",autoFilter:!0}]})}),r.jsx(H,{justify:"justify-between",children:r.jsx("div",{className:"flex gap-4",children:r.jsx(_,{data:s,headers:c,filename:"Asistencias",type:"absents"})})})]})});export{X as default,V as meta};
