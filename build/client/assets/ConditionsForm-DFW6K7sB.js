import{r as w,j as e}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{I as l,S as N,T as C}from"./Inputs-cvlDeTHR.js";import{a as b,C as v}from"./Cards-BPIQ6iiA.js";import{u as z}from"./index.esm-CLpX3RIH.js";import{u as R,a as F}from"./UIContext-9PjeG9pu.js";import{u as U,q as A}from"./DataContext-B4mtDhe5.js";import{F as D}from"./FooterForms-DUyYdG0J.js";import{u as M}from"./updatesSingleRow-C5gkTyzt.js";import{u as E}from"./fieldsChange-DvNB-iS-.js";const L=({watch:a,register:i,setValue:d,disabled:n})=>{var m,o,c,x,h,u,j,g,y,f;w.useEffect(()=>{const r=a("t_mg_materials")+a("t_mg_labor")+a("t_mg_subcontracting")+a("t_mg_others");d("total",r)},[a("t_mg_materials"),a("t_mg_labor"),a("t_mg_subcontracting"),a("t_mg_others")]),w.useEffect(()=>{const r=a("general")??0,s=a("total")*(1+r/100);d("t_mg_total",s)},[a("total")]);const t=(r,s,p)=>{const _=a(r),S=a(s)??0;d(p,_*(1+S/100))};return e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{disabled:n,children:[" ",e.jsx(b,{title:"Margenes de Ganancias",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto divide-y-2 divide-zinc-200 dark:divide-zinc-700",children:[e.jsxs("colgroup",{children:[e.jsx("col",{}),e.jsx("col",{className:"w-[1%]"}),e.jsx("col",{className:"w-[1%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[1%]"})]}),e.jsx("thead",{className:"ltr:text-left rtl:text-right",children:e.jsxs("tr",{className:"*:font-medium *:text-zinc-900 dark:*:text-white",children:[e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Categoria de Cotización"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"INC %"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Márgen/Comp"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total con M/S"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-700",children:[e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Materiales"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((m=a("total_materials"))==null?void 0:m.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(l,{disabled:!1,placeholder:"0 %",...i("materials",{onChange:r=>t("total_materials","materials","t_mg_materials")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((o=a("t_mg_materials"))==null?void 0:o.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Mano de obra"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((c=a("total_labor"))==null?void 0:c.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(l,{disabled:!1,placeholder:"0%",...i("labor",{onChange:r=>t("total_labor","labor","t_mg_labor")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((x=a("t_mg_labor"))==null?void 0:x.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Subcontratos"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((h=a("total_subcontracting"))==null?void 0:h.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(l,{disabled:!1,placeholder:"0%",...i("subcontracting",{onChange:r=>t("total_subcontracting","subcontracting","t_mg_subcontracting")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((u=a("t_mg_subcontracting"))==null?void 0:u.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]}),e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"Otros"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((j=a("total_others"))==null?void 0:j.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:"0 %"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(l,{disabled:!1,placeholder:"0%",...i("others",{onChange:r=>t("total_others","others","t_mg_others")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((g=a("t_mg_others"))==null?void 0:g.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]})]})]})})})]}),e.jsx("fieldset",{disabled:n,children:e.jsx(v,{children:e.jsxs("table",{className:"min-w-full table-auto ",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[4%]"}),e.jsx("col",{className:"w-[1%]"})]}),e.jsx("thead",{className:"ltr:text-left rtl:text-right",children:e.jsxs("tr",{className:"*:font-medium *:text-zinc-900 dark:*:text-white",children:[e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Márgen final"}),e.jsx("th",{className:"px-3 py-2 whitespace-nowrap",children:"Precio final"})]})}),e.jsx("tbody",{className:"",children:e.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((y=a("total"))==null?void 0:y.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx(l,{disabled:n,placeholder:"0%",...i("general",{valueAsNumber:!0,onChange:r=>t("total","general","t_mg_total")})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((f=a("t_mg_total"))==null?void 0:f.toLocaleString("es-AR",{style:"currency",currency:"USD"}))||"$ 0.00"})]})})]})})})]})},$=[{description:"15 días fecha de factura por transferencia bancaria"},{description:"15 días fecha de factura por e-cheq a 15 días"},{description:"30 días fecha de factura por transferencia bancaria"},{description:"30 días fecha de factura por e-cheq a 15 días"},{description:"contra envio de factura por transferencia bancaria"},{description:"contra envio de factura por e-cheq a 15 días"},{description:"contra envio de factura por e-cheq a 30 días"},{description:"Otro"}];function J({quoteActive:a}){const[i,d]=w.useState(!1),{openModal:n}=R(),{editByStatus:t}=F(),{selectedOpportunity:m}=U(),{quotes:o}=m||{},{register:c,formState:{dirtyFields:x,isSubmitSuccessful:h,isDirty:u},handleSubmit:j,reset:g,watch:y,setValue:f}=z({defaultValues:{}}),r=async s=>{n("LOADING");try{await M({dirtyFields:x,formData:s,onUpdate:A.update}),n("SUCCESS",{message:"Oportunidad actualizada correctamente"})}catch(p){n("ERROR",{message:`No se pudo actualizar la oportunidad. Error: ${String(p)}`})}};return E({isSubmitSuccessful:h,isDirty:u}),w.useEffect(()=>{const s=o==null?void 0:o.find(p=>p.id===a);s&&g(s)},[o,a]),e.jsx(e.Fragment,{children:e.jsxs("form",{className:" flex flex-col gap-6",onSubmit:j(r),children:[e.jsx("fieldset",{disabled:!i,children:e.jsx(b,{title:"Formas y metodos de pago",children:e.jsxs("div",{className:"grid lg:grid-cols-2 md:grid-cols-1 gap-2",children:[e.jsx(N,{disabled:!t,label:"Forma de pago",...c("method_payment",{required:!0}),children:$.map(s=>e.jsx("option",{value:s.description,children:s.description},s.description))}),e.jsx(l,{disabled:!t,placeholder:"Plazo de ejecución",label:"Plazo de ejecución",...c("delivery_time")}),e.jsx(l,{disabled:!t,placeholder:"Garantía",label:"Garantía",...c("guarantee")}),e.jsx(l,{disabled:!t,type:"date",placeholder:"Vigencia",label:"Vigencia",...c("validity")}),e.jsx(l,{disabled:!t,type:"date",placeholder:"Fecha probable de inicio",label:"Fecha probable de inicio",...c("estimated_start_date")}),e.jsxs(N,{disabled:!t,label:"Status",...c("status",{required:!0}),children:[e.jsx("option",{value:"",children:"Seleccione un status"}),[{description:"Abierta"},{description:"Cerrada"}].map(s=>e.jsx("option",{value:s.description,children:s.description},s.description))]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(C,{disabled:!t,label:"Notas de Cotización",placeholder:"Notas de Cotización",rows:2,...c("notes")})})]})})}),e.jsx(L,{watch:y,register:c,setValue:f,disabled:!i}),e.jsx(D,{isNew:!1,isEditMode:i,onToggleEdit:()=>d(s=>!s)})]})})}export{J as C,$ as f};
