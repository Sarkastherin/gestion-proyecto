import{r as v,j as e,w as E}from"./chunk-PVWAREVJ-xN2wnjH-.js";import"./ContactsContext-CvsXE9G3.js";import{B as C}from"./Buttons-BBIplumE.js";import{u as N}from"./index.esm-BDlKQGcf.js";import{I as k,S as q}from"./Inputs-nFJy7MmX.js";import{u as z}from"./updatesSingleRow-BjGTgUib.js";import{u as F}from"./ModalsContext-CDMOE33t.js";import{M as A}from"./ModalBase-Cfo712yZ.js";import{X as O,c as I}from"./EntityTable-BPgGIcNJ.js";import{u as R}from"./UIContext-CTPOFttf.js";import{u as U,f as _,c as D,s as T}from"./cruds-C8awoSIz.js";import{u as M}from"./DataContext-BJsy23hk.js";import{b as P,c as $}from"./realTime-CHJ-WwWR.js";import"./functions-kWnBqdLU.js";function B({open:s,fields:m,initialValues:n,method:p,onClose:b}){const{openModal:i}=F(),{register:a,handleSubmit:f,reset:g,formState:{errors:h,dirtyFields:y}}=N({defaultValues:n});v.useEffect(()=>{g(n)},[n]);const u=async r=>{try{if(n!=null&&n.id)await z({dirtyFields:y,formData:r,onUpdate:p.update});else{const{error:c}=await p.insertOne(r);if(c)throw new Error(c.message)}i("SUCCESS",{title:"¡Todo OK!",message:"Configuracion actualizada",variant:"success"})}catch(c){i("ERROR",{title:"Error al actualizar",message:`No se pudo actualizar la configuración: ${String(c)}`,variant:"error"})}finally{b()}};return s?e.jsx(A,{open:s,title:`${n!=null&&n.id?"Editar":"Agregar"} registro`,onClose:b,zIndex:10,footer:{btnPrimary:{label:"Guardar",handleOnClick:f(u)},btnSecondary:{label:"Cancelar",handleOnClick:b,variant:"secondary"}},children:e.jsx("form",{className:"space-y-4 mt-4",onSubmit:f(u),children:m.map(r=>{var c;return e.jsxs("div",{children:[r.type==="text"&&e.jsx(k,{label:r.label,...a(r.name,{required:r.required})}),r.type==="boolean"&&e.jsxs("label",{className:"inline-flex gap-2 text-sm items-center",children:[e.jsx("input",{type:"checkbox",...a(r.name)}),r.label]}),r.type==="select"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:r.name,className:"block text-sm font-medium mb-1",children:r.label}),e.jsxs(q,{...a(r.name,{required:r.required}),defaultValue:"",children:[e.jsx("option",{value:"",children:"— Seleccionar —"}),(c=r.options)==null?void 0:c.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]})]},r.name)})})}):null}const j=({table:s,title:m,columns:n,formFields:p,data:b,method:i})=>{const{openModal:a}=F(),{theme:f}=R(),[g,h]=v.useState(null),[y,u]=v.useState(!1);function r(){h(null),u(!0)}const c=o=>{h(o),u(!0)},x={name:"🗑️",button:!0,cell:o=>e.jsx(C,{variant:"danger_outline",size:"sm",onClick:l=>{l.stopPropagation(),t(o)},children:"Eliminar"}),width:"90px"};async function t(o){if(!confirm("¿Eliminar este registro?"))return;const{error:d}=await i.remove({id:o.id});if(d){a("ERROR",{title:"Error",message:`No se pudo eliminar el elemento ${d.message}`,variant:"error"});return}a("SUCCESS",{title:"¡Todo Ok!",message:"El elemento fue eliminado",variant:"success"})}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:m}),e.jsx("div",{className:"w-32",children:e.jsx(C,{variant:"primary",onClick:r,children:"+ Agregar"})})]}),e.jsx(O,{columns:[...n,x],data:b,customStyles:I,theme:f,pagination:!0,onRowClicked:c,pointerOnHover:!0,highlightOnHover:!0,defaultSortFieldId:"id",paginationPerPage:30}),e.jsx(B,{open:y,onClose:()=>u(!1),table:s,fields:p,initialValues:g,method:i})]})};function se({}){return[{title:"Configuraciones"},{name:"Configuraciones",content:"Configuraciones"}]}const H=[{id:"id",name:"Id",selector:s=>s.id,width:"80px"},{name:"Abreviatura",selector:s=>s.abbreviation,width:"180px"},{name:"Descripción",selector:s=>s.description}],X=[{id:"id",name:"Id",selector:s=>s.id,width:"80px"},{name:"Familia",selector:s=>s.description}],ne=E(function(){P(),$();const[m,n]=v.useState("unidades"),{units:p,getUnits:b,families:i,categories:a,subcategories:f,getCategories:g,getFamilies:h,getSubcategories:y}=M(),{getCategorizations:u,categorizations:r}=R();v.useEffect(()=>{i||h(),a||g(),f||y(),r||u(),p||b()},[]);const c=[{id:"id",name:"Id",selector:t=>t.id,width:"80px"},{name:"Familia",selector:t=>{var l;return((l=i==null?void 0:i.find(d=>d.id===t.id_family))==null?void 0:l.description)??""},width:"230px"},{name:"Rubro",selector:t=>t.description}],x=[{id:"id",name:"Id",selector:t=>t.id,width:"80px"},{name:"Subrubro",selector:t=>t.description},{name:"Rubro",selector:t=>{var l;return((l=a==null?void 0:a.find(d=>d.id===t.id_category))==null?void 0:l.description)??""}},{name:"Familia",selector:t=>{var d,w;const o=(d=a==null?void 0:a.find(S=>S.id===t.id_category))==null?void 0:d.id_family;return((w=i==null?void 0:i.find(S=>S.id===o))==null?void 0:w.description)??""}}];return e.jsxs("div",{className:"flex flex-1 gap-6 min-h-[calc(100vh-64px)]",children:[e.jsx("nav",{className:"w-58 pt-4 space-y-2 border-r border-zinc-300 bg-zinc-200/80 dark:border-zinc-700/60 dark:bg-zinc-900/70 px-4 shadow",children:["unidades","familias","rubros","subrubros"].map((t,o)=>e.jsx(C,{type:"button",onClick:()=>n(t),variant:m===t?"primary":"secondary",className:"w-full",children:t.charAt(0).toUpperCase()+t.slice(1)},o))}),e.jsxs("div",{className:"flex-1 py-4 mx-auto pe-10",children:[m==="unidades"&&e.jsx(j,{table:"units",title:"Unidades",columns:H,data:p||[],method:U,formFields:[{name:"description",label:"Descripción",type:"text",required:!0},{name:"abbreviation",label:"Abreviatura",type:"text",required:!0}]}),m==="familias"&&e.jsx(j,{table:"families",title:"Familias",columns:X,data:i||[],method:_,formFields:[{name:"description",label:"Descripción",type:"text",required:!0}]}),m==="rubros"&&e.jsx(j,{table:"categories",title:"Rubros",columns:c,data:a||[],method:D,formFields:[{name:"description",label:"Descripción",type:"text",required:!0},{name:"id_family",label:"Familia",type:"select",options:i==null?void 0:i.map(t=>({value:t.id,label:t.description})),required:!0}]}),m==="subrubros"&&e.jsx(j,{table:"subcategories",title:"Subrubros",columns:x,data:f||[],method:T,formFields:[{name:"description",label:"Descripción",type:"text",required:!0},{name:"id_category",label:"Rubro",type:"select",options:a==null?void 0:a.map(t=>{var l;const o=(l=i==null?void 0:i.find(d=>d.id===t.id_family))==null?void 0:l.description;return{value:t.id,label:`${t.description}-[🧩${o}]`}}),required:!0}]})]})]})});export{ne as default,se as meta};
