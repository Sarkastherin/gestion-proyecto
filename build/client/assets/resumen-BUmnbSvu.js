import{w as j,r as x,a as y,j as e}from"./chunk-PVWAREVJ-xN2wnjH-.js";import"./UIContext-DAvkThde.js";import{u as f}from"./DataContext-BsNWaLsj.js";import{C as N}from"./Cards-BrE1Rw6C.js";import{a as g}from"./Containers-PvQTCG8J.js";import{a as b,B as w}from"./Badge-CULYdmWM.js";import{B as z}from"./Buttons-CDHNjhxE.js";import{F as v}from"./BriefcaseIcon-C0T0Pvmi.js";import"./ModalsContext-CDMOE33t.js";import"./functions-DVvIYcXa.js";import"./Buttons-BBIplumE.js";import"./Link-DPrQ_H2S.js";import"./TrashIcon-B0Rn98mB.js";function $({}){return[{title:"Nueva Oportunidad"},{name:"description",content:"Nueva Oportunidad"}]}const T=(a,i,d)=>{var n;if(!a||!i||!d)return[];const c=new Map,o=a.details_materials.filter(s=>s.id_quote===i);for(const s of o){const l=`${s.id_material}-${s.id_price}`,p=(n=d.find(u=>u.id===s.materials.id_unit))==null?void 0:n.description,m=c.get(l);m?c.set(l,{...m,quantity:m.quantity+s.quantity}):c.set(l,{...s,unit:p})}const r=Array.from(c.values()),t=a.details_items.filter(s=>s.id_quote===i);return[...r,...t]},k=({selectedOpportunity:a,totalQuote:i})=>{if(!a)return null;const{name:d,client:c,created_at:o,phases:r,quotes:t,status:n}=a;return e.jsxs(N,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:d||"Oportunidad sin nombre"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:[a.id_project&&e.jsx(b,{size:"md",variant:"success",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-5"})," Proyecto creado"]})}),e.jsx(w,{size:"md",variant:n||"No status",children:n||"!"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cliente:"})," ",e.jsx("span",{children:c.nombre??"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha de creaci贸n:"})," ",e.jsx("span",{children:new Date(o).toLocaleDateString()})]}),e.jsxs("div",{className:"row-span-2",children:[e.jsx("span",{className:"font-medium block mb-1",children:"Etapas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(r==null?void 0:r.length)>0?r.map(s=>e.jsx("span",{className:"px-3 py-0.5 rounded-full text-xs bg-indigo-100 text-indigo-700 font-medium",children:s.name},s.id)):e.jsx("span",{className:"text-zinc-400",children:"No definidas"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total estimado:"})," ",e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.toLocaleString("es-AR",{style:"currency",currency:"USD"}))??"0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cotizaciones asociadas:"})," ",e.jsx("span",{children:(t==null?void 0:t.length)??0})]})]})]})},C=({details:a})=>{const[i,d]=x.useState("Todos"),c=x.useMemo(()=>{const t=new Set(a.map(n=>n.type));return["Todos",...Array.from(t)]},[a]),o=x.useMemo(()=>i==="Todos"?a:a.filter(t=>t.type===i),[a,i]);if(!a.length)return e.jsx("p",{className:"text-sm text-zinc-400",children:"No hay detalles para esta cotizaci贸n."});const r=[{label:"TIPO",key:"type"},{label:"ID MATERIAL",key:"materials.id"},{label:"DESCRIPCION MATERIAL",key:"materials.description"},{label:"DESCRIPCION ITEM",key:"item"},{label:"CANTIDAD",key:"quantity"},{label:"PRECIO UNITARIO",key:"prices.price"},{label:"PRECIO UNITARIO",key:"unit_cost"},{label:"UNIDAD",key:"unit"}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2 mt-6 mb-4 sm:items-center",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Detalle de la cotizaci贸n"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:c.map(t=>e.jsx("button",{onClick:()=>d(t),className:`text-sm px-3 py-1 rounded-full border ${i===t?"bg-yellow-200 text-yellow-700 border-yellow-400":"bg-zinc-100 text-zinc-500 border-zinc-300 dark:bg-zinc-700 dark:border-zinc-700 dark:text-zinc-400"}`,children:t},t))}),e.jsx(z,{data:o,headers:r,filename:`detalle_cotizacion_${a[0].id_quote}_${i.toLocaleLowerCase()}`,type:"resumen"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full border border-zinc-300 dark:border-zinc-700 rounded-md text-sm",children:[e.jsx("thead",{className:"bg-white text-zinc-600 dark:bg-zinc-900/70 dark:text-zinc-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Descripci贸n"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Unidad"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Precio Unitario"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:o.map((t,n)=>{var u,h;const s="unit_cost"in t,l=s?t.unit_cost??0:((u=t.prices)==null?void 0:u.price)??0,p=s?t.item??"-":((h=t.materials)==null?void 0:h.description)??"-",m=s?"Unidad":t.unit??"-";return e.jsxs("tr",{className:"border-t border-zinc-300 dark:border-zinc-700",children:[e.jsx("td",{className:"px-4 py-2",children:t.type.toUpperCase()}),e.jsx("td",{className:"px-4 py-2",children:p}),e.jsx("td",{className:"px-4 py-2 text-right",children:t.quantity}),e.jsx("td",{className:"px-4 py-2 text-right",children:m}),e.jsx("td",{className:"px-4 py-2 text-right",children:l.toLocaleString("es-AR",{style:"currency",currency:"USD"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:(t.quantity*l).toLocaleString("es-AR",{style:"currency",currency:"USD"})})]},`${t.type}-${n}`)})})]})})]})},F=j(function(){const[i,d]=x.useState(0),[c,o]=x.useState(null),{selectedQuoteId:r}=y(),{units:t,getUnits:n}=f(),{selectedOpportunity:s}=f(),{quotes:l}=s||{};return x.useEffect(()=>{t||n()},[]),x.useEffect(()=>{const p=l==null?void 0:l.find(m=>m.id===r);p&&(d(p.t_mg_total),t&&o(T(s,r,t)))},[r,t]),e.jsxs(g,{children:[e.jsx(k,{selectedOpportunity:s,totalQuote:i}),t&&e.jsx(C,{details:c??[]})]})});export{F as default,$ as meta};
