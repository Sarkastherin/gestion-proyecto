import{w as S,u as R,r as m,j as e}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{E as P}from"./EntityTable-CYBYbV-K.js";import{u as L}from"./DataContext-B4mtDhe5.js";import{S as B}from"./Containers-ZXGJ7diH.js";import{P as H}from"./ProtectedRoute-DTKDj7Jz.js";import{f as O}from"./functionsDays-BZooa-Ef.js";import{A as T}from"./allowedRoles-DvcEYYJr.js";import{L as V}from"./LoaderComponent-DzoOhiNN.js";import{u as A}from"./index.esm-CLpX3RIH.js";import{I as h}from"./Inputs-cvlDeTHR.js";import{B as y}from"./Buttons-C61rKE9q.js";import{F as N,M as I}from"./index-Ds5NNZRZ.js";import{B as M}from"./briefcase-business-C6ySRwuO.js";import"./UIContext-9PjeG9pu.js";import"./supabaseClient-O5NoNd5h.js";import"./Buttons-dijALP0_.js";import"./index-DvKACyVh.js";import"./functions-llu_GUtd.js";import"./TrashIcon-CpHN25SK.js";import"./ContactsContext-BtjVusI7.js";import"./IconComponent-CkWBZZXK.js";import"./arrow-left-3CO6tBoR.js";import"./AuthContext-DiXfFtBN.js";import"./iconBase-C9B2YtSF.js";function pe({}){return[{title:"Consolidado de horas por proyecto"},{name:"description",content:"Consolidado de horas por proyecto"}]}const Q=[{name:"Empleado",selector:i=>i.project_name||"",sortable:!0},{name:"Horas equivalentes",selector:i=>i.total_equivalent_hours,sortable:!0,width:"150px"},{name:"Días equivalentes",selector:i=>i.total_equivalent_days,sortable:!0,width:"150px"},{name:"Viáticos",selector:i=>i.total_viaticum,sortable:!0,width:"120px"},{name:"Comidas",selector:i=>i.alimentation,sortable:!0,width:"120px"}],be=S(function(){const g=R(),{getLiquidationReport:q,liquidationReport:d}=L(),{register:u,handleSubmit:w,getValues:p}=A();m.useEffect(()=>{d||q()},[]);const[x,k]=m.useState(null),[c,z]=m.useState({total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0}),b=l=>{var f,_;const a={};if(!d)return;let o=d;if((f=l==null?void 0:l.filters)!=null&&f.project_name&&(o=o.filter(t=>{var s;return(s=t.project_name)==null?void 0:s.toLowerCase().includes(l.filters.project_name.toLowerCase())})),(_=l==null?void 0:l.filters)!=null&&_.from){const t=new Date(l.filters.from).getTime(),s=l.filters.to?new Date(l.filters.to).getTime():1/0;o=o.filter(n=>new Date(n.date_report).getTime()>=t&&new Date(n.date_report).getTime()<=s)}o.forEach(t=>{var v;const s=t.project_name||"Desconocido";a[s]||(a[s]={project_name:s,total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0,employees:[]}),a[s].total_equivalent_hours+=t.equivalent_hours??0,a[s].total_equivalent_hours=parseFloat(a[s].total_equivalent_hours.toFixed(2)),t.viaticum&&(a[s].total_viaticum+=1),t.equivalent_hours&&(a[s].total_equivalent_days+=t.equivalent_hours/9),a[s].total_equivalent_days=parseFloat(a[s].total_equivalent_days.toFixed(2)),t.absent||(a[s].alimentation+=1);const n=a[s].employees.find(D=>{var j;return D.employee_name===((j=t.employee)==null?void 0:j.contacto_nombre)});n?(n.equivalent_hours+=t.equivalent_hours??0,n.equivalent_days+=t.equivalent_hours?parseFloat(((t.equivalent_hours??0)/9).toFixed(2)):0,n.alimentation+=t.absent?0:1,t.viaticum&&(n.viaticum+=1),n.dayReport.push(t)):a[s].employees.push({employee_name:((v=t.employee)==null?void 0:v.contacto_nombre)||"Desconocido",equivalent_hours:t.equivalent_hours??0,equivalent_days:t.equivalent_hours?parseFloat(((t.equivalent_hours??0)/9).toFixed(2)):0,viaticum:t.viaticum?1:0,alimentation:t.absent?0:1,dayReport:[t]})});const r={total_equivalent_hours:0,total_viaticum:0,total_equivalent_days:0,alimentation:0};Object.values(a).forEach(t=>{r.total_equivalent_hours+=t.total_equivalent_hours,r.total_viaticum+=t.total_viaticum,r.total_equivalent_days+=t.total_equivalent_days,r.alimentation+=t.alimentation}),z(r),k(Object.values(a))};m.useEffect(()=>{d&&b()},[d]);const F=({data:l})=>e.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-800/40",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Horas de ",l.project_name]}),l.employees.map(a=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-medium mb-1",children:a.employee_name}),e.jsxs("p",{children:["Horas equivalentes: ",a.equivalent_hours]}),e.jsxs("p",{children:["Viáticos: ",a.viaticum]}),e.jsxs("details",{className:"mt-2 text-sm",children:[e.jsx("summary",{className:"text-blue-700 dark:text-blue-300",children:"Detalles"}),e.jsxs("table",{className:"w-full text-left border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"font-medium",children:[e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Fecha"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"HS-EQ"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Días EQ"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Viático"}),e.jsx("th",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:"Comida"})]})}),e.jsx("tbody",{children:a.dayReport.map(o=>{var r;return e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:O(o.date_report)}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:((r=o.equivalent_hours)==null?void 0:r.toFixed(2))||"0"}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:(o.equivalent_hours?o.equivalent_hours/9:0).toFixed(2)}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:o.viaticum?"Sí":"No"}),e.jsx("td",{className:"border-b border-zinc-300 dark:border-zinc-700/60 px-4 py-2",children:o.absent?"No":"Sí"})]},o.id)})})]})]})]},a.employee_name))]}),E=l=>{b({filters:l})},C=()=>{g("/rrhh/consolidated_hours_per_project/pdf",{state:{data:x,globalBalance:c,periodo:{from:p("from"),to:p("to")}}})};return x?e.jsx(H,{allowed:T,children:e.jsxs("div",{className:"flex flex-1 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"w-full overflow-x-auto py-4 px-4 lg:px-10",children:[e.jsx("div",{className:"my-4",children:e.jsx(B,{title:"Consolidado de horas por proyecto",back_path:"/rrhh",IconComponent:{component:M,color:"text-purple-600"}})}),e.jsxs("form",{onSubmit:w(E),className:"flex flex-col lg:flex-row gap-2 lg:gap-4 items-stretch lg:items-end w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{label:"Filtrar por proyecto",...u("project_name")})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h,{label:"Desde",type:"date",...u("from")}),e.jsx("span",{className:"text-sm",children:"a"}),e.jsx(h,{type:"date",label:"Hasta",...u("to")})]}),e.jsx(y,{type:"submit",icon:{component:N,color:""},children:"Filtrar"})]}),e.jsx("div",{className:"w-full lg:w-auto hidden",children:e.jsx(y,{type:"submit",icon:{component:N,color:""},children:"Filtrar"})})]}),e.jsx(P,{data:x,columns:Q,expandableRows:!0,disableRowClick:!0,ExpandedComponent:F,buttonOnClick:{title:"Reporte en PDF",color:"red",onClick:C,icon:{component:I,color:"text-white"}}})]}),e.jsxs("div",{className:"hidden md:flex flex-col items-center w-54 pt-10 border-r border-zinc-300 bg-white dark:border-zinc-700/60 dark:bg-zinc-900/70 px-4 shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-yellow-700 dark:text-yellow-500 flex items-center",children:e.jsx("span",{children:"Balance global"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-400 mb-1",children:"Horas equivalentes"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_equivalent_hours.toFixed(2)})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300 mb-1",children:"Días equivalentes"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_equivalent_days.toFixed(2)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300 mb-1",children:"Viáticos"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.total_viaticum})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/30 rounded-lg p-4 flex flex-col items-center shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-pink-700 dark:text-pink-300 mb-1",children:"Alimentación"}),e.jsx("span",{className:"text-2xl font-semibold",children:c.alimentation})]})]})]})]})}):e.jsx(V,{})});export{be as default,pe as meta};
