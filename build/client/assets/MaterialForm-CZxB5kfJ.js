import{r as o,u as B,j as r}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{u as w,m as E}from"./DataContext-B4mtDhe5.js";import{u as $}from"./index.esm-CLpX3RIH.js";import{u as k,a as H}from"./UIContext-9PjeG9pu.js";import{a as J}from"./Cards-BPIQ6iiA.js";import{S as g,I as b}from"./Inputs-cvlDeTHR.js";import{F as K}from"./FooterForms-DUyYdG0J.js";import{b as Q}from"./realTime-VCRs_Sia.js";import{S as W}from"./SelectUnits-Bs_i1Q0t.js";import{u as X}from"./updatesSingleRow-C5gkTyzt.js";const oe=({defaultValues:F,isNew:l,categorization:t,initialEditMode:A})=>{var S,j,y,v,_,C;const[c,M]=o.useState(A),{selectedMaterial:m,getMaterials:N}=w();Q(m==null?void 0:m.id);const{openModal:d}=k(),I=B(),[p,R]=o.useState(null),[f,U]=o.useState(null),[q,O]=o.useState(!1),{getCategorizations:D,categorizations:i}=H(),{register:n,formState:{errors:u,dirtyFields:P},handleSubmit:T}=$({defaultValues:F??{id_subcategory:null,description:"",id_unit:null}}),L=async e=>{try{if(l){d("LOADING",{title:"Guardando material",message:"Por favor, espere..."});const{data:a,error:s}=await E.insertOne(e);if(s||!a||!("id"in a))throw new Error("Error al crear oportunidad");d("SUCCESS",{title:"Material creado con éxito",message:"El material se ha creado correctamente."}),N(),I(`/material/${a==null?void 0:a.id}`)}!l&&c&&(d("LOADING",{title:"Actualizando material",message:"Por favor, espere..."}),await X({dirtyFields:Object.fromEntries(Object.entries(P).filter(([a,s])=>typeof s=="boolean")),formData:e,onUpdate:E.update}),d("SUCCESS",{title:"Material actualizado con éxito",message:"El material se ha actualizado correctamente."}))}catch(a){d("ERROR",{title:"Error al actualizar material",message:String(a)})}};o.useEffect(()=>{i||D()},[]);const x=e=>{if(!i)return;const{categories:a}=i;R((a==null?void 0:a.filter(s=>s.id_family===Number(e)))||[])},h=e=>{if(!i)return;const{subcategories:a}=i;U((a==null?void 0:a.filter(s=>s.id_category===Number(e)))||[])},V=e=>{const s=e.target.value;s!==""&&x(Number(s))},G=e=>{const s=e.target.value;s!==""&&h(Number(s))};return o.useEffect(()=>{i&&(!l&&t&&(x(t.id_family),h(t.id_category)),O(!0))},[t,i]),r.jsx(r.Fragment,{children:q&&r.jsxs("form",{className:" flex flex-col gap-6",onSubmit:T(L),children:[r.jsx("fieldset",{disabled:!c,children:r.jsx(J,{title:"Datos del material",children:r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsxs("div",{className:"grid md:grid-cols-3 sm:grid-cols-1 gap-2",children:[r.jsx(g,{id:"id_family",label:"Familia",selectText:"Selecciona familia",onChange:V,defaultValue:l?"":t==null?void 0:t.id_family,error:(S=u.id_subcategory)==null?void 0:S.message,children:(j=i==null?void 0:i.families)==null?void 0:j.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))}),r.jsx(g,{id:"id_category",label:"Rubro",selectText:"Seleccion rubro",onChange:G,error:(y=u.id_subcategory)==null?void 0:y.message,defaultValue:l?"":t==null?void 0:t.id_category,children:p==null?void 0:p.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))}),r.jsx(g,{label:"Sub-rubro",selectText:"Seleccion sub-rubro",...n("id_subcategory",{required:"Campo requerido",valueAsNumber:!0}),error:(v=u.id_subcategory)==null?void 0:v.message,children:f==null?void 0:f.map(e=>r.jsx("option",{value:e.id,children:e.description},e.id))})]}),r.jsx(b,{label:"Descripción",placeholder:"Descripción del material",...n("description",{required:"Campo requerido"}),error:(_=u.description)==null?void 0:_.message}),r.jsxs("div",{className:"grid md:grid-cols-2 sm:grid-cols-1 gap-2",children:[r.jsx(W,{label:"Unidad",...n("id_unit",{required:"Campo requerido",valueAsNumber:!0}),error:(C=u.id_unit)==null?void 0:C.message}),r.jsx(b,{label:"Peso",type:"number",placeholder:"Peso en gramos",defaultValue:0,...n("weight",{valueAsNumber:!0})})]}),r.jsx(b,{label:"Aplicación",placeholder:"Aplicación",...n("application")})]})})}),r.jsx(K,{isNew:l,isEditMode:c,onToggleEdit:()=>M(e=>!e)})]})})};export{oe as M};
