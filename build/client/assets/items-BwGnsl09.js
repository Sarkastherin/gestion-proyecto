import{w as _,r as b,j as t}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{u as R,a as O}from"./index.esm-CLpX3RIH.js";import{u as M,a as $}from"./UIContext-9PjeG9pu.js";import{F as q}from"./FooterForms-DUyYdG0J.js";import{T as z,C as i}from"./TableDetailsQuotes-BoXQZsCR.js";import{I as n}from"./Inputs-cvlDeTHR.js";import{b as U,c as k}from"./Buttons-dijALP0_.js";import{r as B}from"./functions-llu_GUtd.js";import{u as G}from"./updatesArraysFields-CDmdxi8j.js";import{u as L,b as h}from"./DataContext-B4mtDhe5.js";import{u as H}from"./fieldsChange-DvNB-iS-.js";import"./supabaseClient-O5NoNd5h.js";import"./Buttons-C61rKE9q.js";import"./IconComponent-CkWBZZXK.js";import"./index-DvKACyVh.js";import"./TrashIcon-CpHN25SK.js";import"./ContactsContext-BtjVusI7.js";function ue({}){return[{title:"Proyecto [Presupuesto]"},{name:"description",content:"Proyecto [Presupuesto]"}]}const ce=_(function(){const[d,I]=b.useState(!1),[j,y]=b.useState([]),{openModal:r}=M(),{propsQuoteAndBudget:s,editByStatus:K}=$(),{selectedProject:l}=L(),{register:u,formState:{dirtyFields:x,isSubmitSuccessful:S,isDirty:C},handleSubmit:w,control:A,watch:c,reset:g}=R(),{fields:T,append:v,remove:E}=O({control:A,name:"items"}),D=async e=>{if(!C){r("INFORMATION",{message:"No hay cambios para actualizar'"});return}r("LOADING",{message:"Procesando requerimiento"});try{const{items:o}=e,a=await G({fieldName:"items",fieldsArray:o,dirtyFields:x,fieldsDelete:j,onInsert:h.insertOne,onRemove:m=>h.remove({id:m}),onUpdate:h.update}),f=o.filter(m=>"id"in m&&typeof m.id=="number");g({items:[...f,...Array.isArray(a)?a:[]]}),y([]),r("SUCCESS",{message:"Se han guardado los datos"})}catch{r("ERROR",{message:"No se pudo actualizar la oportunidad."})}},F=()=>{s&&s.selsectedPhase>0&&v({id_project:l==null?void 0:l.id,id_phase:s.selsectedPhase,type:s.activeType,item:"",quantity:0,unit_cost:0,notes:"",observations:""})},N=e=>{const a=c("items")[e];a&&"id"in a&&a.id!==void 0&&y(f=>[...f,a.id]),E(e)},{budget_details_items:p}=l||{};b.useEffect(()=>{p&&g({items:p})},[p]);const P=[{groupColsClass:"w-[1%]",label:"#"},{groupColsClass:"",label:"Elemento cotizado"},{groupColsClass:"w-[10%]",label:"Cantidad"},{groupColsClass:"w-[10%]",label:"Costo unitario"},{groupColsClass:"w-[10%]",label:"Total"},{groupColsClass:"w-[1%]",label:"ðŸ—‘ï¸"}];return H({isSubmitSuccessful:S,isDirty:C}),t.jsx(t.Fragment,{children:(s==null?void 0:s.selsectedPhase)&&t.jsx(z,{title:"Tabla Items",columns:P,handleSubmit:w(D),isEditMode:d,addElement:t.jsx(k,{disabled:!d,title:"Agregar Item",onClick:F}),footerElement:t.jsx(q,{isNew:!1,isEditMode:d,onToggleEdit:()=>I(e=>!e)}),children:T.map((e,o)=>({...e,index:o})).filter(e=>e.type===s.activeType&&e.id_phase===s.selsectedPhase).map(({index:e,id:o})=>t.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[t.jsx(i,{children:e+1}),t.jsx(i,{children:t.jsx(n,{...u(`items.${e}.item`),placeholder:"Ãtem",disabled:!1})}),t.jsx(i,{children:t.jsx(n,{type:"number",disabled:!1,step:.01,...u(`items.${e}.quantity`,{valueAsNumber:!0})})}),t.jsx(i,{children:t.jsx(n,{disabled:!1,type:"number",...u(`items.${e}.unit_cost`,{valueAsNumber:!0})})}),t.jsx(i,{children:t.jsx(n,{type:"number",placeholder:"Total",readOnly:!0,value:B(c(`items.${e}.quantity`)*c(`items.${e}.unit_cost`),2)||0})}),t.jsx(i,{children:t.jsx(U,{disabled:!1,onClick:()=>N(e)})})]},o))})})});export{ce as default,ue as meta};
