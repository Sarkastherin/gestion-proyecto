import{r as a,u as z,j as e,w as E,b as C,O as k}from"./chunk-PVWAREVJ-xN2wnjH-.js";import{u as y}from"./UIContext-DAvkThde.js";import{u as A}from"./realTime-CTR1wkWo.js";import{B as w}from"./Buttons-BBIplumE.js";import{q as p}from"./cruds-CKZRngPt.js";import{I as Z}from"./Inputs-nFJy7MmX.js";import{B as I}from"./SectionCreateQuote-DpyYwo5D.js";import{u as j}from"./DataContext-BsNWaLsj.js";import{I as M}from"./ItemsHeader-C3hwTJ6z.js";import{F as S}from"./BriefcaseIcon-C0T0Pvmi.js";import{F as $}from"./PresentationChartBarIcon-COHXvKHZ.js";import{u as B}from"./ModalsContext-CDMOE33t.js";import"./Cards-BrE1Rw6C.js";import"./Link-DPrQ_H2S.js";import"./ModalBase-Cfo712yZ.js";import"./EntityTable-BR0JMe50.js";import"./Badge-CULYdmWM.js";import"./useModalState-DqEB_XcK.js";import"./functions-DVvIYcXa.js";function F({title:i,titleId:r,...t},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},t),i?a.createElement("title",{id:r},i):null,a.createElement("path",{fillRule:"evenodd",d:"M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3Zm9 3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm-6.25-.75a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM11.5 6A.75.75 0 1 1 13 6a.75.75 0 0 1-1.5 0Z",clipRule:"evenodd"}),a.createElement("path",{d:"M13 11.75a.75.75 0 0 0-1.5 0v.179c0 .15-.138.28-.306.255A65.277 65.277 0 0 0 1.75 11.5a.75.75 0 0 0 0 1.5c3.135 0 6.215.228 9.227.668A1.764 1.764 0 0 0 13 11.928v-.178Z"}))}const g=a.forwardRef(F);function L({title:i,titleId:r,...t},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},t),i?a.createElement("title",{id:r},i):null,a.createElement("path",{fillRule:"evenodd",d:"M11.986 3H12a2 2 0 0 1 2 2v6a2 2 0 0 1-1.5 1.937v-2.523a2.5 2.5 0 0 0-.732-1.768L8.354 5.232A2.5 2.5 0 0 0 6.586 4.5H4.063A2 2 0 0 1 6 3h.014A2.25 2.25 0 0 1 8.25 1h1.5a2.25 2.25 0 0 1 2.236 2ZM10.5 4v-.75a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75V4h3Z",clipRule:"evenodd"}),a.createElement("path",{d:"M3 6a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1v-3.586a1 1 0 0 0-.293-.707L7.293 6.293A1 1 0 0 0 6.586 6H3Z"}))}const H=a.forwardRef(L);function V({title:i,titleId:r,...t},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},t),i?a.createElement("title",{id:r},i):null,a.createElement("path",{fillRule:"evenodd",d:"M4.784 3A2.25 2.25 0 0 0 2.68 4.449L1.147 8.475A2.25 2.25 0 0 0 1 9.276v1.474A2.25 2.25 0 0 0 3.25 13h9.5A2.25 2.25 0 0 0 15 10.75V9.276c0-.274-.05-.545-.147-.801l-1.534-4.026A2.25 2.25 0 0 0 11.216 3H4.784Zm-.701 1.983a.75.75 0 0 1 .7-.483h6.433a.75.75 0 0 1 .701.483L13.447 9h-2.412a1 1 0 0 0-.832.445l-.406.61a1 1 0 0 1-.832.445h-1.93a1 1 0 0 1-.832-.445l-.406-.61A1 1 0 0 0 4.965 9H2.553l1.53-4.017Z",clipRule:"evenodd"}))}const _=a.forwardRef(V);function D({title:i,titleId:r,...t},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},t),i?a.createElement("title",{id:r},i):null,a.createElement("path",{fillRule:"evenodd",d:"M5.25 2A2.25 2.25 0 0 0 3 4.25v9a.75.75 0 0 0 1.183.613l1.692-1.195 1.692 1.195a.75.75 0 0 0 .866 0l1.692-1.195 1.693 1.195A.75.75 0 0 0 13 13.25v-9A2.25 2.25 0 0 0 10.75 2h-5.5Zm5.53 4.28a.75.75 0 1 0-1.06-1.06l-4.5 4.5a.75.75 0 1 0 1.06 1.06l4.5-4.5ZM7 6.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm2.75 4.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"}))}const P=a.forwardRef(D);function Q({title:i,titleId:r,...t},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},t),i?a.createElement("title",{id:r},i):null,a.createElement("path",{fillRule:"evenodd",d:"M2 3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v8.5a2.5 2.5 0 0 1-5 0V3Zm3.25 8.5a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z",clipRule:"evenodd"}),a.createElement("path",{d:"m8.5 11.035 3.778-3.778a1 1 0 0 0 0-1.414l-2.122-2.121a1 1 0 0 0-1.414 0l-.242.242v7.07ZM7.656 14H13a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-.344l-5 5Z"}))}const U=a.forwardRef(Q);function T({setHidden:i,selectedQuoteId:r}){var d;const{selectedOpportunity:t}=j(),o=z(),u=t==null?void 0:t.id,x=(l=>[{title:"Resumen",href:`/opportunity/${l}/resumen`,icon:e.jsx($,{className:"w-4"})},{title:"Información",href:`/opportunity/${l}/information`,icon:e.jsx(_,{className:"w-4"})},{title:"Etapas",href:`/opportunity/${l}/phases`,icon:e.jsx(U,{className:"w-4"})},{title:"Cotización",href:`/opportunity/${l}/quotes/materials`,icon:e.jsx(g,{className:"w-4"})},{title:"Margenes y Condiciones",href:`/opportunity/${l}/conditions`,icon:e.jsx(P,{className:"w-4"})},{title:"Informes",href:`/opportunity/${l}/report`,icon:e.jsx(H,{className:"w-4"})}])(Number(u));return e.jsx(e.Fragment,{children:t&&e.jsx(M,{iconTitle:e.jsx(g,{className:"w-5 text-white dark:text-zinc-900"}),color:"bg-blue-500",title:t==null?void 0:t.name,menu:x,rightSection:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[(t==null?void 0:t.quotes)&&((d=t==null?void 0:t.quotes)==null?void 0:d.length)>0&&!t.id_project&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:"Cotización activa:"}),e.jsx("div",{className:"w-20",children:e.jsx(Z,{defaultValue:r??void 0,readOnly:!0,onClick:()=>i(!1)})})]}),e.jsx(I,{label:" + Nueva Cotización"})]}),(t==null?void 0:t.id_project)&&e.jsx(w,{variant:"green",children:e.jsxs("div",{className:"flex items-center gap-1",onClick:()=>o(`/project/${t.id_project}/resumen`),children:[e.jsx(S,{className:"w-5"})," Ver Proyecto"," "]})})]})})})}const me=E(function(){A();const{openModal:r}=B(),[t,o]=a.useState(null),{getOpportunityById:u,selectedOpportunity:n,setSelectedOpportunity:x}=j(),{setSelectedClient:d,setEditByStatus:l}=y(),{id:b}=C();a.useEffect(()=>{u(Number(b))},[]),a.useEffect(()=>{if(n&&n.client){d(n.client);const s=n==null?void 0:n.quotes.find(c=>c.active);o((s==null?void 0:s.id)??null),l(["Nuevo","En proceso","Revisión"].some(c=>c===(n==null?void 0:n.status)))}},[n]);const[N,f]=a.useState(!0),v=()=>{f(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{setHidden:f,selectedQuoteId:t}),n?e.jsx(k,{context:{selectedQuoteId:t}}):e.jsx("p",{className:"text-center mt-10",children:"Cargando Oportunidad..."}),e.jsx("div",{className:`fixed inset-0 z-50 grid place-content-center bg-white/10 p-4 ${N&&"hidden"}`,role:"dialog","aria-modal":"true","aria-labelledby":"modalTitle",children:e.jsxs("div",{className:"w-full max-w-lg min-w-sm rounded-lg bg-white p-6 shadow-lg dark:bg-zinc-900 text-indigo-600 dark:text-indigo-400",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h2",{id:"modalTitle",className:"text-xl font-bold sm:text-2xl",children:"Cambiar de cotización"}),e.jsx("button",{type:"button",onClick:v,className:"-me-4 -mt-4 rounded-full p-2 text-zinc-400 transition-colors hover:bg-zinc-50 hover:text-zinc-600 focus:outline-none dark:text-zinc-500 dark:hover:bg-zinc-800 dark:hover:text-zinc-300","aria-label":"Cerrar",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("fieldset",{className:"space-y-3",children:[e.jsx("legend",{className:"sr-only",children:"Cambiar cotización activa"}),n==null?void 0:n.quotes.map(s=>e.jsx("div",{children:e.jsxs("label",{htmlFor:s.id.toLocaleString(),className:"flex items-center justify-between gap-4 rounded border border-zinc-300 bg-white p-3 text-sm font-medium shadow-sm transition-colors hover:bg-zinc-50 has-checked:border-indigo-600 has-checked:ring-1 has-checked:ring-indigo-600 dark:border-zinc-600 dark:bg-zinc-900 dark:hover:bg-zinc-800",children:[e.jsxs("p",{className:"text-zinc-700 dark:text-zinc-200",children:["Id Cotización N° ",s.id]}),e.jsxs("p",{className:"text-zinc-900 dark:text-white",children:["Monto:"," ",(s.t_mg_total??0).toLocaleString("es-AR",{style:"currency",currency:"USD"})]}),e.jsx("input",{id:s.id.toLocaleString(),type:"radio",name:"SelectedQuote",className:"sr-only",value:s.id.toLocaleString(),checked:s.active,onChange:async()=>{if(s.active)return;f(!0),r("LOADING",{title:"Actualizando...",message:"Aplicando cambio de cotización activa."});const m=n==null?void 0:n.quotes.find(h=>h.active),c=m==null?void 0:m.id;if(c){const{error:h}=await p.update({id:c,values:{active:!1}});if(h){r("ERROR",{message:"No se pudo desactivar la cotización anterior."});return}}const{error:R}=await p.update({id:s.id,values:{active:!0}});R?r("ERROR",{message:"No se pudo activar la nueva cotización."}):r("SUCCESS",{message:"Cotización cambiada."})}})]})},s.id))]})}),e.jsx("footer",{className:"mt-6 flex justify-end",children:e.jsx(w,{type:"button",onClick:v,variant:"secondary",children:"Cerrar"})})]})})]})});export{me as default};
