import{r,u as V,j as e,w as D,c as y}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{b as F}from"./functions-CIXTKjf3.js";import{u as $}from"./DataContext-BHROWMOn.js";import{u as W}from"./useModalState-Dynfoma4.js";import{M as P}from"./ModalBase-Czr0Q5I6.js";import{L as _}from"./LoaderComponent-DzoOhiNN.js";import{F as E}from"./ClipboardDocumentCheckIcon-C0qHNpyc.js";import"./supabaseClient-O5NoNd5h.js";import"./ContactsContext-BtjVusI7.js";import"./Buttons-DjYWmDVV.js";import"./IconComponent-CkWBZZXK.js";function I({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"}))}const T=r.forwardRef(I);function q({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 0 0 .75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 0 0-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0 1 12 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 0 1-.673-.38m0 0A2.18 2.18 0 0 1 3 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 0 1 3.413-.387m7.5 0V5.25A2.25 2.25 0 0 0 13.5 3h-3a2.25 2.25 0 0 0-2.25 2.25v.894m7.5 0a48.667 48.667 0 0 0-7.5 0M12 12.75h.008v.008H12v-.008Z"}))}const G=r.forwardRef(q);function K({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}))}const k=r.forwardRef(K);function U({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z"}))}const Y=r.forwardRef(U);function J({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Q=r.forwardRef(J);function X({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"}))}const ee=r.forwardRef(X);function te({title:i,titleId:s,...d},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},d),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"}))}const re=r.forwardRef(te);function se({open:i,onClose:s,stage:d}){const n=V();return e.jsx(P,{title:`Oportunidades ${d.title}`,open:i,zIndex:50,onClose:s,width:"max-w-lg",children:e.jsx("div",{className:"px-2 pt-4 overflow-y-auto",style:{maxHeight:"calc(100vh - 270px)"},children:e.jsx("ul",{children:d.items.map(h=>e.jsx("li",{title:"Ir a la oportunidad",className:"cursor-pointer p-3 mb-2 text-sm rounded-lg border border-zinc-200/70 bg-white/85 text-zinc-700 shadow-sm transition hover:-translate-y-0.5 hover:border-zinc-300 hover:bg-white dark:hover:bg-zinc-900 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/60 dark:border-zinc-700/70 dark:bg-zinc-900/70 dark:text-zinc-200 dark:hover:border-zinc-600",onClick:()=>n(`opportunities/${h.id}/resumen`),children:h.name},h.id))})})})}function he({}){return[{title:"Bienvenido"},{name:"description",content:"Bienvenido"}]}const be=D(function(){const s=W(),{getOpportunities:d,opportunities:n,getProjects:h,projects:j,holidays:f,getHolidays:M,reportsEmployees:b,getReportsEmployees:R}=$(),z=[{key:"won",label:"Oportunidades ganadas",value:"0",tone:"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/30 dark:bg-emerald-500/10 dark:text-emerald-200",icon:e.jsx(T,{className:"w-4"})},{key:"closed",label:"Oportunidades perdidas",value:"0",tone:"border-slate-200 bg-slate-50 text-slate-700 dark:border-slate-500/30 dark:bg-slate-500/10 dark:text-slate-200",icon:e.jsx(E,{className:"w-4"})},{key:"pending",label:"Oportunidades pendientes",value:"0",tone:"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/30 dark:bg-amber-500/10 dark:text-amber-200",icon:e.jsx(Q,{className:"w-4"})}],N=[{key:"new",title:"Nuevas",value:0,items:[],tone:"border-blue-400/50 dark:border-blue-600/50 bg-blue-50 dark:bg-blue-600/10 text-blue-700 dark:text-blue-300"},{key:"sent",title:"Enviadas",value:0,items:[],tone:"border-purple-400/50"},{key:"inReview",title:"En proceso y revisión",value:0,items:[],tone:"border-orange-400/50"}],[H,L]=r.useState(z),[A,C]=r.useState(N),[w,O]=r.useState(()=>{const t=new Date,o=String(t.getMonth()+1).padStart(2,"0");return`${t.getFullYear()}-${o}`}),[x,S]=r.useState(null),[u,Z]=r.useState(null);r.useEffect(()=>{n||d(),j||h(),f||M(),b||R()},[]),r.useEffect(()=>{if(!n)return;const[t,o]=w.split("-").map(Number);if(!t||!o)return;const a=new Date(t,o-1,1,0,0,0,0),l=new Date(t,o,0,23,59,59,999),p=n.filter(c=>{const g=new Date(c.created_at);return g>=a&&g<=l}).reduce((c,g)=>{const v=g.status;return v==="Ganada"?(c.won+=1,c):v==="Perdida"||v==="Vencida"||v==="Desestimada"?(c.closed+=1,c):(c.pending+=1,c)},{won:0,closed:0,pending:0});L(z.map(c=>({...c,value:String(p[c.key])})))},[n,w]),r.useEffect(()=>{if(!n)return;const t=n.filter(a=>!["Ganada","Perdida","Vencida","Desestimada"].includes(a.status)),o={new:[],sent:[],inReview:[]};t.forEach(a=>{a.status==="Nuevo"?o.new.push({name:a.name||"Sin nombre",id:a.id||0}):a.status==="Enviada"?o.sent.push({name:a.name||"Sin nombre",id:a.id||0}):(a.status==="En proceso"||a.status==="Revisión")&&o.inReview.push({name:a.name||"Sin nombre",id:a.id||0})}),C(N.map(a=>({...a,value:o[a.key].length,items:o[a.key]})))},[n]),r.useEffect(()=>{if(!b)return;const t={};b.forEach(l=>{const m=l.project_name||"Sin proyecto",p=l.hours_worked||0;t[m]?t[m]+=p:t[m]=p});const a=Object.entries(t).map(([l,m])=>({project:l,hours:`${m.toFixed(0)} HH`})).sort((l,m)=>{const p=parseFloat(l.hours);return parseFloat(m.hours)-p});Z(a.slice(0,3))},[b]);const B=[{title:"Nueva oportunidad",description:"Crear y calificar prospectos",icon:e.jsx(G,{className:"w-5"}),tone:"bg-green-500/10 text-green-600 dark:text-green-400",to:"/opportunities/new-opportunity"},{title:"Registrar parte diario",description:"Actividad y avances del día",icon:e.jsx(E,{className:"w-5"}),tone:"bg-blue-500/10 text-blue-600 dark:text-blue-400",to:"/projects/new-daily-report"},{title:"Nuevo material",description:"Agregar insumos al catálogo",icon:e.jsx(ee,{className:"w-5"}),tone:"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",to:"/materials/new-material"},{title:"Agregar feriado",description:"Registrar días no laborables",icon:e.jsx(k,{className:"w-5"}),tone:"bg-purple-500/10 text-purple-600 dark:text-purple-400",to:"/settings/calendar"}];return r.useEffect(()=>{if(!f)return;const o=f.filter(a=>new Date(a.date)>=new Date).sort((a,l)=>new Date(a.date).getTime()-new Date(l.date).getTime());S(o.slice(0,3))},[f]),!n||!j||!x||!b?e.jsx(_,{content:"Cargando indicadores"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-gradient-to-b from-zinc-50 via-zinc-50 to-zinc-100 dark:from-zinc-950 dark:via-zinc-950 dark:to-zinc-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10",children:[e.jsxs("section",{className:"grid gap-8 lg:grid-cols-[1.2fr_0.8fr] items-stretch",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-8 shadow-sm dark:border-zinc-800 dark:bg-zinc-900/80",children:[e.jsx("div",{className:"flex items-start justify-between gap-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-zinc-400",children:"Centro operativo"}),e.jsx("h1",{className:"mt-3 text-3xl font-semibold text-zinc-900 dark:text-zinc-100",children:"Tablero de oportunidades"}),e.jsx("p",{className:"mt-3 text-zinc-500 dark:text-zinc-400",children:"Visualiza los status de las oportunidades por periodo."})]})}),e.jsxs("div",{className:"mt-5 flex flex-wrap items-center gap-3 text-xs text-zinc-500 dark:text-zinc-400",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-zinc-200 bg-white/80 px-3 py-1 dark:border-zinc-700 dark:bg-zinc-900/60",children:[e.jsx("span",{className:"uppercase tracking-[0.2em]",children:"Mes"}),e.jsx("input",{type:"month",value:w,onChange:t=>O(t.target.value),className:"bg-transparent text-xs text-zinc-700 focus:outline-none dark:text-zinc-200"})]}),e.jsx("span",{children:"Indicadores del periodo seleccionado"})]}),e.jsx("div",{className:"mt-8 grid gap-4 sm:grid-cols-3",children:H.map(t=>e.jsxs("div",{className:`rounded-xl border p-4 ${t.tone}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-zinc-600 dark:text-zinc-300",children:t.label}),e.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-white/70 text-zinc-500 dark:bg-zinc-900/40 dark:text-zinc-200",children:t.icon})]}),e.jsxs("div",{className:"mt-3 flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-semibold text-zinc-900 dark:text-zinc-100",children:t.value}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"total"})]})]},t.label))})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900/80",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-zinc-600 dark:text-zinc-300",children:[e.jsx(Y,{className:"w-5"}),"Acciones rápidas"]}),e.jsx("div",{className:"mt-4 grid gap-3",children:B.map(t=>e.jsxs(y,{to:t.to,className:"flex items-center justify-between rounded-xl border border-zinc-200 bg-white px-4 py-3 text-left transition hover:-translate-y-0.5 hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950/40",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`flex h-10 w-10 items-center justify-center rounded-lg ${t.tone}`,children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-800 dark:text-zinc-100",children:t.title}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:t.description})]})]}),e.jsx("span",{className:"text-xs text-zinc-400",children:"Ir"})]},t.title))})]})]}),e.jsxs("section",{className:"mt-10 ",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-zinc-400",children:"Pipeline"}),e.jsx("h1",{className:"mt-2 mb-4 text-xl font-semibold text-zinc-900 dark:text-zinc-100",children:"Oportunidades"}),e.jsx("div",{className:"grid gap-6 lg:grid-cols-3",children:A.map(t=>e.jsxs("div",{className:`rounded-2xl border ${t.tone} bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900/80`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-600 dark:text-zinc-300 uppercase tracking-wide",children:t.title}),e.jsx("span",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 bg-zinc-200/70 dark:bg-zinc-700/70 px-3 py-1 rounded-full",children:t.value})]}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-zinc-500 dark:text-zinc-400",children:t.items.slice(0,3).map(o=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-zinc-400"}),o.name]},o.id))}),e.jsx("button",{type:"button",className:"text-xs font-medium text-primary-text hover:bg-zinc-200/50 dark:hover:bg-zinc-700/50 mt-4 rounded-full px-3 py-1 transition",onClick:()=>{s.openModal(t)},children:"Ver mas"})]},t.title))})]}),e.jsxs("section",{className:"mt-10 grid gap-6 lg:grid-cols-[1.2fr_0.8fr]",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900/80",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-zinc-600 dark:text-zinc-300",children:[e.jsx(re,{className:"w-5"}),"RRHH · HH por proyecto"]}),e.jsxs("div",{className:"mt-5 space-y-3",children:[u==null?void 0:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-zinc-200 px-4 py-3 text-sm dark:border-zinc-800",children:[e.jsx("span",{className:"text-zinc-600 dark:text-zinc-300",children:t.project}),e.jsx("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:t.hours})]},t.project)),(u==null?void 0:u.length)===0&&e.jsx("div",{className:"text-center text-zinc-400 dark:text-zinc-600 py-4 text-xs",children:"No hay datos disponibles"})]}),e.jsx(y,{to:"/rrhh/reports_assistance",className:"block text-xs font-medium text-primary-text hover:bg-zinc-200/50 dark:hover:bg-zinc-700/50 mt-4 rounded-full px-3 py-1 transition w-fit",children:"Ver analiticas RRHH"})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900/80",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-zinc-600 dark:text-zinc-300 mb-2",children:[e.jsx(k,{className:"w-5 text-blue-500 dark:text-blue-400"}),"Próximos feriados"]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[x==null?void 0:x.map(t=>{const o=t.date.split("-"),a=new Date(Number(o[0]),Number(o[1])-1,Number(o[2]),12,0,0),l=a.toLocaleDateString(void 0,{weekday:"short"}),m=a.toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"});return e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-blue-100 dark:border-blue-900 bg-blue-50/60 dark:bg-blue-900/30 px-4 py-3 text-sm shadow-sm",children:[e.jsx("span",{className:"flex items-center justify-center h-8 w-8 rounded-full bg-blue-200/60 dark:bg-blue-800/60 text-blue-700 dark:text-blue-200 font-bold",children:e.jsx(k,{className:"w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"block font-medium text-blue-900 dark:text-blue-100",children:t.name}),e.jsxs("span",{className:"block text-xs text-blue-700 dark:text-blue-300",children:[l,", ",m]})]})]},t.name+t.date)}),(x==null?void 0:x.length)===0&&e.jsx("div",{className:"text-center text-zinc-400 dark:text-zinc-600 py-4 text-xs",children:"No hay feriados próximos"})]})]})]})]})}),s.data&&e.jsx(se,{open:s.open,onClose:s.closeModal,stage:s.data}),e.jsx("div",{className:"fixed bottom-0 w-full bg-zinc-200 dark:bg-zinc-900 py-2 px-4",children:e.jsxs("p",{className:"text-end text-xs text-zinc-400 dark:text-zinc-600",children:["Versión: ",e.jsx("span",{className:"font-mono",children:F})]})})]})});export{be as default,he as meta};
