import{w as _,r as h,a as q,j as t}from"./chunk-PVWAREVJ-Cl_c9Jt0.js";import{u as z,a as M}from"./index.esm-CLpX3RIH.js";import{u as $,a as U}from"./UIContext-9PjeG9pu.js";import{F as k}from"./FooterForms-DUyYdG0J.js";import{T as B,C as i}from"./TableDetailsQuotes-BoXQZsCR.js";import{I as d}from"./Inputs-cvlDeTHR.js";import{b as G,c as L}from"./Buttons-dijALP0_.js";import{r as Q}from"./functions-llu_GUtd.js";import{u as H}from"./updatesArraysFields-CDmdxi8j.js";import{u as J,d as b}from"./DataContext-B4mtDhe5.js";import{u as K}from"./fieldsChange-DvNB-iS-.js";import"./supabaseClient-O5NoNd5h.js";import"./Buttons-C61rKE9q.js";import"./IconComponent-CkWBZZXK.js";import"./index-DvKACyVh.js";import"./TrashIcon-CpHN25SK.js";import"./ContactsContext-BtjVusI7.js";function pe({}){return[{title:"Oportunidad [CotizaciÃ³n]"},{name:"description",content:"Oportunidad [CotizaciÃ³n]"}]}const fe=_(function(){const[C,g]=h.useState(!1),{selectedQuoteId:u}=q(),[x,y]=h.useState([]),{openModal:l}=$(),{propsQuoteAndBudget:o,editByStatus:r}=U(),{selectedOpportunity:S}=J(),{register:c,formState:{dirtyFields:w,isSubmitSuccessful:A,isDirty:I},handleSubmit:T,control:v,watch:p,reset:j}=z(),{fields:E,append:D,remove:F}=M({control:v,name:"items"}),N=async e=>{if(!I){l("INFORMATION",{message:"No hay cambios para actualizar'"});return}l("LOADING",{message:"Procesando requerimiento"});try{const{items:s}=e,a=await H({fieldName:"items",fieldsArray:s,dirtyFields:w,fieldsDelete:x,onInsert:b.insertOne,onRemove:m=>b.remove({id:m}),onUpdate:b.update}),f=s.filter(m=>"id"in m&&typeof m.id=="number");j({items:[...f,...Array.isArray(a)?a:[]]}),y([]),l("SUCCESS",{message:"Se han guardado los datos"})}catch{l("ERROR",{message:"No se pudo actualizar la oportunidad."})}},O=()=>{o&&o.selsectedPhase>0&&D({id_quote:u,id_phase:o.selsectedPhase,type:o.activeType,item:"",quantity:0,unit_cost:0,notes:"",observations:""})},P=e=>{const a=p("items")[e];a&&"id"in a&&a.id!==void 0&&y(f=>[...f,a.id]),F(e)},{details_items:n}=S||{};h.useEffect(()=>{const e=n==null?void 0:n.filter(s=>s.id_quote===u);e&&j({items:e})},[n,u]);const R=[{groupColsClass:"w-[1%]",label:"#"},{groupColsClass:"",label:"Elemento cotizado"},{groupColsClass:"w-[10%]",label:"Cantidad"},{groupColsClass:"w-[10%]",label:"Costo unitario"},{groupColsClass:"w-[10%]",label:"Total"},{groupColsClass:"w-[1%]",label:"ðŸ—‘ï¸"}];return K({isSubmitSuccessful:A,isDirty:I}),t.jsx(t.Fragment,{children:(o==null?void 0:o.selsectedPhase)&&t.jsx(B,{title:"Tabla Items",columns:R,handleSubmit:T(N),isEditMode:C,addElement:t.jsx(L,{disabled:!r,title:"Agregar Item",onClick:O}),footerElement:t.jsx(k,{isNew:!1,isEditMode:C,onToggleEdit:()=>g(e=>!e)}),children:E.map((e,s)=>({...e,index:s})).filter(e=>e.type===o.activeType&&e.id_phase===o.selsectedPhase).map(({index:e,id:s})=>t.jsxs("tr",{className:"*:text-zinc-900 *:first:font-medium dark:*:text-white",children:[t.jsx(i,{children:e+1}),t.jsx(i,{children:t.jsx(d,{...c(`items.${e}.item`),placeholder:"Ãtem",disabled:!r})}),t.jsx(i,{children:t.jsx(d,{type:"number",disabled:!r,step:.01,...c(`items.${e}.quantity`,{valueAsNumber:!0})})}),t.jsx(i,{children:t.jsx(d,{disabled:!r,type:"number",...c(`items.${e}.unit_cost`,{valueAsNumber:!0})})}),t.jsx(i,{children:t.jsx(d,{type:"number",placeholder:"Total",readOnly:!0,value:Q(p(`items.${e}.quantity`)*p(`items.${e}.unit_cost`),2)||0})}),t.jsx(i,{children:t.jsx(G,{disabled:!r,onClick:()=>P(e)})})]},s))})})});export{fe as default,pe as meta};
